<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>FIGHT</title>
        <script src="../database/players.js"></script>
        <script src="../database/database.js"></script>
        <link rel="stylesheet" href="menu.css">
        <link rel="stylesheet" href="../Teams/teams.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    </head>

    <body id="fight_bg">
        <form id="fight_form_fight" class="fight-form">
            <label for="red_corner_search">Red Corner</label>
            <input type="text" id="red_corner_search" placeholder="Type player's name" class="fight-input">
            <div id="red_corner_suggestions" class="suggestions"></div>

            <label for="blue_corner_search">Blue Corner</label>
            <input type="text" id="blue_corner_search" placeholder="Type player's name" class="fight-input">
            <div id="blue_corner_suggestions" class="suggestions"></div>

            <input type="submit" class="fight-submit" value="Fight">
        </form>


        <div class="corner_container">
            <div id="red_corner"></div>
            <div class="chart">
                <div>
                    <p id="crit"></p>
                    <p id="damage"></p>
                </div>

                <form id="attack-form">
                    <label>Turn</label>
                    <select id="attacker">
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                    </select>
                    <label>Choose Move</label>
                    <select id="actioner">
                        <option>Attack</option>
                        <option>Magic Attack</option>
                        <option>Cursed Tool Attack</option>
                        <option>Ninjutsu</option>
                        <option>Ultimate Ninjutsu</option>
                        <option>Curse Technique</option>
                        <option>Genjutsu</option>
                        <option>Devil Contract</option>
                        <option>Domain Expansion</option>
                        <option>Hatsu Buff</option>
                        <option>Zetsu Buff</option>
                        <option>Boost</option>
                        <option>Drain</option>
                        <option>Update HP</option>
                    </select>
                    <input type="submit">
                </form>
                <a target="_blank" href="affinity.html" class="chart-a">View Elemental Chart</a>
            </div>
            <div id="blue_corner"></div>
        </div>
    </body>

    <script>
        $('#attack-form').hide()
        let databaseArr = database;

        let blueAttack
        let blueDefense
        let blueCrit
        let blueElmAttack
        let blueElmDef
        let blueElmEffc
        let blueHp
        let blueStrength
        let bluePotency
        let blueBuff
        let blueBuff2
        let blueELM
        let blueChakra
        let blueRecovery //
        let blueCost
        let blueChakraPower
        let blueNinjutsu
        let blueNinCost
        let blueNinPower
        let blueAcc
        let blueEvas
        let blueLuck
        let blueGen
        let blueGenPow
        let blueWill;
        let blueNenNinDmg
        let blueNenNinCost
        let blueCurseEnergy
        let blueCurseRec
        let blueCurseTech
        let blueCurseDuration
        let blueCurseCost
        let blueCurseAmount
        let blueDomPurity
        let blueDomLethal
        let blueDomDuration
        let blueDomCost
        let blueDomName
        let blueNinAmount
        let blueUltAmount
        let blueNinEnhance
        let blueUltEnhance
        let blueWeapon
        let blueShield
        let blueWeaponCrit
        let blueWeaponCurse
        let blueWeaponAmount
        let blueStun
        let blueDrain
        let blueNegative
        let blueStatus = []
        let blueCurses = []

        let redAttack
        let redDefense
        let redCrit
        let redElmAttack
        let redElmDef
        let redElmEffc
        let redHp
        let redStrength
        let redPotency
        let redBuff
        let redBuff2
        let redELM
        let redChakra
        let redRecovery
        let redCost
        let redChakraPower
        let redNinjutsu
        let redNinCost
        let redNinPower
        let redAcc
        let redEvas
        let redLuck
        let redGen;
        let redGenPow
        let redWill;
        let redNenNinDmg
        let redNenNinCost
        let redCurseEnergy
        let redCurseRec
        let redCurseTech
        let redCurseDuration
        let redCurseCost
        let redCurseAmount
        let redDomPurity
        let redDomLethal
        let redDomDuration
        let redDomCost
        let redDomName
        let redNinAmount
        let redUltAmount
        let redNinEnhance
        let redUltEnhance
        let redWeapon
        let redShield
        let redWeaponCrit
        let redWeaponCurse
        let redWeaponAmount
        let redStun
        let redDrain
        let redNegative
        let redStatus = []
        let redCurses = []
        function chargeCurse(player, damage) {
            console.log(`time to charge ${player} player,,,${damage} damage`)
            let currRedCurse = parseInt($('#redCurrCurse').text(), 10);
            let currBlueCurse = parseInt($('#blueCurrCurse').text(), 10);

            if (player == 'red') {
                let firstRecovery = 100 - redCurseRec;
                let recovery = damage / firstRecovery;
                currRedCurse += recovery;
                $('#redCurrCurse').text(Math.round(currRedCurse))
            } else {
                let firstRecovery = 100 - blueCurseRec;
                let recovery = damage / firstRecovery;
                currBlueCurse += recovery;
                console.log(`this is recovery ${firstRecovery} and after dicison its ${recovery} added`)
                $('#blueCurrCurse').text(Math.round(currBlueCurse))
            }

        }

        function buff(buff, attacker, cost, ultCost, jutsu, enhance, ultimate) {

            let amount = 0
            if (ultimate) {
                amount = ultCost
            } else {
                amount = cost
            }

            //physical
            let attack = ['C3', 'En-Strike', 'Hidden-Blades', 'Playful-Cloud', 'Claw', 'Ice-Fist', 'Auto-Pilot-Mode', 'Water-Prison-Shark-Dance']
            let defense = ['RAM', 'RAGE', 'Rising-Sun', 'Big-Bang-Impact', 'Heavenly-Restriction', 'Rasenshuriken', 'Unblockable-Drumming-Beat', 'Strength-of-a-Hundred-Seals']
            let critical = ['Awakening', 'Explosive-Tags', 'Fury', 'Terpsichora', 'Cowardly-Monster-Hunter']
            let Strength1 = ["Roar", 'Knuckle-Bracers', 'ButterFly-Mode', 'Scissors', 'Harden']
            //Magic
            let magic = ['Sand-Coffin', 'Purple-Arrow', 'Iaid≈ç-Master', 'Chidori', 'Thunderbolt', 'Water-Prison-Shark-Dance']
            let magicDef = ['Flame-Control', "Rage-Blast", , 'Heavenly-Weeping', 'Amaterasu', 'Amaterasu-Arrow', 'Nen-Bullets', 'Flex', 'Tailed-Beast-Bomb', 'Strength-of-a-Hundred-Seals']
            let potency = ['Explosive', 'Flowing-Red-Scale', 'Double-Machine-Gun', 'Thunder-Spears']
            let efficieny = ['Thunder-Spear', 'Pain-Packer', 'Wind-Scythe', 'Water-Shark-Bomb']
            // Cursed tool
            let weapon = ['Knife', 'Totsuka-Blade', 'Body-Alteration', 'Spiky-Human-Bolder', 'Ackerman-Curse', 'Jaws', 'Kamaitachi', 'Water-Prison-Shark-Dance']
            let shield = ['Claws', 'Earth-Grudge-Fear', 'Wood-Locking-Wall', 'Ice-Harden', 'Water-Formation-Wall', 'Strength-of-a-Hundred-Seals']
            let witherPer = []
            let witherAmount = ['Ratio-Technique', 'Cystal-Claws']
            //speed + recovery + luck
            let accuracy = ['SCREAM', 'Whirlwind']
            let evasion = ['Collapse', 'Sword-Draw-Dash', 'Chain-Entanglement', 'Future-Devil', 'Orange-Arrow', 'SCREAM', 'Gate-Release', 'Speed-of-Lightning', 'Ash-Pile-Burning']
            let recovery = ['Reaper', 'Yasaka', 'Blinky', 'Inhale', 'Great-Forest-Technique', 'Parasitic-Destruction', 'Lightning-Clone', 'Adamantine-Sealing-Chains']
            let luck = []
            // genjutsu
            let genjutsu = ['Dark-Bushido']
            let power = ["Dance-of-the-Serpent's-Bite", 'Battle-Cantabile-Jupiter', 'Cursed-Broom']
            let willpower = ['Art-of-the-Doppelganger', 'Rhythm-Echo']
            // curse tech
            let curseRec = ['Teleporting-Rasengan', 'Yasaka-Magatama', 'Rasengan', 'Vibra-Slap', 'Sting', 'Third-Hand']
            let curseCost = []
            let curseDur = []
            let domPurity = ['Rotation']
            let domDur = ['Sand-Mauseliem', 'Dance', 'Tsukoyomi']
            let domLethal = ['C4', 'Hypnotic-Spell', 'Battle-Cantabile-Metamorphosen']
            let domCost = []
            // ninjutsu
            let ninCosted = ['Texture-Surprise']
            let ninDamage = ["Lariat", 'Knife', 'Ripper-Cyclotron', 'Insect-Sphere', 'Raikiri', 'Bungee-Gum', 'Flying-Swallow', 'Shadow-Neck-Breaking']
            let ultCosted = []
            let ultDamage = []
            let elem = []
            let heal = ['Blood-Consumption', 'Heart-Mask', 'Magical-Esthetician', 'Doctor-Blythe', 'Regeneration', 'Heal-Bite', 'Mystical-Palm', 'Nen-Stitches']
            let misc = ['Aura-Synthesis', 'Aura', 'Curse-Devil', 'Black-Voice-Control', 'Reaper-Death-Seal', 'Kamui']
            let stun = ['Batto-Sword-Drawing', 'Eletric-Yo-Yo', '8-Trigram-64-Palms', 'Leaf-Hurricane', 'Knife-Fighter']
            let trade = ['Jajanken']
            let percentDmg = ['Blood-Suck']
            let special = ['I.R.S']
            let setNin = ['Hakoware'] //ie SET CHAKRA TO 0


            buff = buff / 100;
            isBuff = Math.random() < buff;
            if (isBuff) {
                //LONG IF CHAIN HEREEEE
                // ATTACK
                let currRedHp = parseInt($('#redHP').text(), 10)
                let currBlueHp = parseInt($('#blueHP').text(), 10)
                if (attack.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redAttack = Math.floor(redAttack * (1 + amount));
                        } else {
                            blueAttack = Math.floor(blueAttack * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueAttack = Math.floor(blueAttack * (1 + amount))
                        } else {
                            redAttack = Math.floor(redAttack * (1 - amount))
                        }
                    }
                }
                if (defense.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redDefense = Math.floor(redDefense * (1 + amount));
                        } else {
                            blueDefense = Math.floor(blueDefense * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueDefense = Math.floor(blueDefense * (1 + amount))
                        } else {
                            redDefense = Math.floor(redDefense * (1 - amount))
                        }
                    }
                }
                if (critical.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redCrit = (redCrit * (1 + amount)).toFixed(2)
                        } else {
                            blueCrit = (blueCrit * (1 - amount)).toFixed(2)
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueCrit = (blueCrit * (1 + amount)).toFixed(2)
                        } else {
                            redCrit = (redCrit * (1 - amount)).toFixed(2)
                        }
                    }
                }
                if (Strength1.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redStrength += amount
                        } else {
                            blueStrength -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueStrength += amount
                        } else {
                            redStrength -= amount
                        }
                    }
                }
                // MAGIC
                if (magic.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redElmAttack = Math.floor(redElmAttack * (1 + amount));
                        } else {
                            blueElmAttack = Math.floor(blueElmAttack * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueElmAttack = Math.floor(blueElmAttack * (1 + amount))
                        } else {
                            redElmAttack = Math.floor(redElmAttack * (1 - amount))
                        }
                    }
                }
                if (magicDef.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redElmDef = Math.floor(redElmDef * (1 + amount));
                        } else {
                            alert('sasuke doing work')
                            blueElmDef = Math.floor(blueElmDef * (1 - amount));
                            alert(blueElmDef)
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueElmDef = Math.floor(blueElmDef * (1 + amount))
                        } else {
                            redElmDef = Math.floor(redElmDef * (1 - amount))
                        }
                    }
                }
                if (efficieny.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redElmEffc = (redElmEffc * (1 + amount)).toFixed(2);
                        } else {
                            blueElmDef = (blueElmEffc * (1 - amount)).toFixed(2);
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueElmEffc = (blueElmEffc * (1 + amount)).toFixed(2)
                        } else {
                            redElmEffc = (redElmEffc * (1 - amount)).toFixed(2)
                        }
                    }
                }
                if (potency.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redPotency = (redPotency * (1 + amount)).toFixed(2);
                        } else {
                            bluePotency = (bluePotency * (1 - amount)).toFixed(2);
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            bluePotency = (bluePotency * (1 + amount)).toFixed(2)
                        } else {
                            redPotency = (redPotency * (1 - amount)).toFixed(2)
                        }
                    }
                }
                if (heal.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            currRedHp += amount;
                            $('#redHP').text(currRedHp)
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            currBlueHp += amount;
                            $('#blueHP').text(currBlueHp)
                        }
                    }
                }
                // CURSED TOLL
                if (weapon.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redWeapon = (redWeapon * (1 + amount)).toFixed(2);
                        } else {
                            blueWeapon = (blueWeapon * (1 - amount)).toFixed(2);
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueWeapon = (blueWeapon * (1 + amount)).toFixed(2);
                        } else {
                            redWeapon = (redWeapon * (1 - amount)).toFixed(2);
                        }
                    }
                }
                if (shield.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redShield = Math.floor((redShield * (1 + amount)));
                        } else {
                            blueShield = Math.floor((blueShield * (1 - amount)));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueShield = Math.floor((blueShield * (1 + amount)));
                        } else {
                            redShield = Math.floor((redShield * (1 - amount)));
                        }
                    }
                }
                if (witherPer.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redWeaponCrit += amount
                        } else {
                            blueWeaponCrit -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueWeaponCrit += amount
                        } else {
                            redWeaponCrit -= amount
                        }
                    }
                }
                if (witherAmount.includes(jutsu)) {
                    alert('nanami ultimate nin casted', enhance)
                    if (attacker == 'red') {
                        if (enhance) {
                            redWeaponAmount += amount
                            alert(`Nanami wither increased to ${redWeaponAmount}`)
                        } else {
                            blueWeaponAmount -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueWeaponAmount += amount
                        } else {
                            redWeaponAmount -= amount
                        }
                    }
                }
                //SPPED
                if (accuracy.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redAcc += amount
                        } else {
                            blueAcc -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueAcc += amount
                        } else {
                            redAcc -= amount
                        }
                    }
                }
                if (evasion.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redEvas += amount;
                        } else {
                            blueEvas -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueEvas += amount
                        } else {
                            redEvas -= amount
                        }
                    }
                }
                if (recovery.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redRecovery += amount
                            alert(`red recovery has risen to ${redRecovery}`)
                        } else {
                            blueRecovery -= amount
                            alert(`Blue recovery has fallen to ${blueRecovery}`)
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueRecovery += amount
                            alert(`Blue recovery has risen to ${blueRecovery}`)
                        } else {
                            redRecovery -= amount
                            alert(`Red recovery has fallen to ${redRecovery}`)
                        }
                    }
                }
                if (luck.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redLuck += amount
                            alert(`red Luck has risen to ${redLuck}`)
                        } else {
                            blueLuck -= amount
                            alert(`Blue Luck has fallen to ${blueLuck}`)
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueLuck += amount
                            alert(`Blue Luck has risen to ${blueLuck}`)
                        } else {
                            redLuck -= amount
                            alert(`Red Luck has fallen to ${redLuck}`)
                        }
                    }
                }
                if (stun.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redStun += amount
                        } else {
                            blueStun -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueStun += amount
                        } else {
                            redStun -= amount
                        }
                    }
                    alert(`red stun: ${redStun}, blue stun ${blueStun}`)
                }
                // GENJUTSUUU
                if (willpower.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redWill += amount
                        } else {
                            blueWill -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueWill += amount
                        } else {
                            redWill -= amount
                        }
                    }
                }
                if (genjutsu.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redGen += amount;
                        } else {
                            blueGen -= amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueGen += amount
                        } else {
                            redGen -= amount
                        }
                    }
                }
                if (power.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redGenPow = Math.floor(redGenPow * (1 + amount));
                        } else {
                            blueGenPow = Math.floor(blueGenPow * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueGenPow = Math.floor(blueGenPow * (1 + amount))
                        } else {
                            redGenPow = Math.floor(redGenPow * (1 - amount))
                        }
                    }
                }
                // CURSE AND DOMAIN
                if (curseRec.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redCurseRec = redCurseRec + amount;
                        } else {
                            blueCurseRec = blueCurseRec - amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueCurseRec = blueCurseRec + amount
                        } else {
                            redCurseRec = redCurseRec - amount
                        }
                    }
                    alert(`Red Curse: ${redCurseRec}, Blue Curse ${blueCurseRec}`)
                }
                if (curseDur.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redCurseDuration = redCurseDuration + amount;
                        } else {
                            blueCurseDuration = blueCurseDuration - amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueCurseDuration = blueCurseDuration + amount
                        } else {
                            redCurseDuration = redCurseDuration - amount
                        }
                    }
                }
                if (curseCost.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redCurseCost = Math.floor(redCurseCost * (1 + amount));
                        } else {
                            blueCurseCost = Math.floor(blueCurseCost * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueCurseCost = Math.floor(blueCurseCost * (1 + amount))
                        } else {
                            redCurseCost = Math.floor(redCurseCost * (1 - amount))
                        }
                    }
                }
                //DOMAIN
                if (domPurity.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redDomPurity += amount;
                        } else {
                            blueDomPurity -= amount;
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueDomPurity += amount
                        } else {
                            redDomPurity -= amount
                        }
                    }
                }
                if (domDur.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redDomDuration = redDomDuration + amount;
                        } else {
                            blueCurseDuration = blueDomDuration - amount
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueDomDuration = blueDomDuration + amount
                        } else {
                            redDomDuration = redDomDuration - amount
                        }
                    }
                }
                if (domCost.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redDomCost += (redDomCost * (1 + amount)).toFixed(2);
                        } else {
                            blueDomCost -= (blueDomCost * (1 - amount)).toFixed(2);
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueDomCost += (blueDomCost * (1 + amount)).toFixed(2)
                        } else {
                            redDomCost -= (redDomCost * (1 - amount)).toFixed(2)
                        }
                    }
                }
                if (domLethal.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redDomLethal += amount;
                        } else {
                            blueDomLethal -= amount;
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueDomLethal += amount
                        } else {
                            redDomLethal -= amount
                        }
                    }
                }
                //NINJUTS STATSSS
                if (ninCosted.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redNenNinCost = Math.floor(redNenNinCost * (1 - amount));
                            alert(`half off! ${redNenNinCost}`)
                        } else {
                            blueNenNinCost = Math.floor(blueNenNinCost * (1 + amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueNenNinCost = Math.floor(blueNenNinCost * (1 - amount))
                        } else {
                            redNenNinCost = Math.floor(redNenNinCost * (1 + amount))
                        }
                    }
                }
                if (ninDamage.includes(jutsu)) {
                    console.log('LARIATOOO is in the Array!!!!', blueNenNinDmg)
                    if (attacker == 'red') {
                        if (enhance) {
                            redNenNinDmg = Math.floor(redNenNinDmg * (1 + amount));
                        } else {
                            blueNenNinDmg = Math.floor(blueNenNinDmg * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueNenNinDmg = Math.floor(blueNenNinDmg * (1 + amount))
                        } else {
                            redNenNinDmg = Math.floor(redNenNinDmg * (1 - amount))
                        }
                    }
                }
                // ULTIMATE NINJUTSU
                if (ultCosted.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redNinCost = Math.floor(redNinCost * (1 + amount));
                        } else {
                            blueNinCost = Math.floor(blueNinCost * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueNinCost = Math.floor(blueNinCost * (1 + amount))
                        } else {
                            redNinCost = Math.floor(redNinCost * (1 - amount))
                        }
                    }
                }
                if (ultDamage.includes(jutsu)) {
                    if (attacker == 'red') {
                        if (enhance) {
                            redNinPower = Math.floor(redNinPower * (1 + amount));
                        } else {
                            blueNinPower = Math.floor(blueNinPower * (1 - amount));
                        }
                    } else if (attacker == 'blue') {
                        if (enhance) {
                            blueNinPower = Math.floor(blueNinPower * (1 + amount))
                        } else {
                            redNinPower = Math.floor(redNinPower * (1 - amount))
                        }
                    }
                }
                if (trade.includes(jutsu)) {

                    if (attacker == 'red') {
                        if (enhance) {
                            redNinPower += 200;
                            redRecovery -= 2
                            alert(`Jajanken ${redNinPower} power, ${redRecovery} recovery`)
                        }
                    }
                    else if (attacker == 'blue') {
                        if (enhance) {
                            blueNinPower += 200
                            blueRecovery -= 2
                        }
                    }
                }
                if (jutsu == 'MISC' || misc.includes(jutsu)) {
                    let stat_max = prompt('redAttack, redDefense, redCrit,  redStr, redElmAttack, redElmDef, redElmEffc, redPot, redELM, redRecovery, redEvas, redAcc, redLuck, redGen, redGenPow, redWill, redNinjutsuCost, redUltNinCost, redNinjutsuPower,redDomDur, redDomPurity, redDomLethal, redCurseRec, redWeapon, redShield, redStun, redWitherPer, redHeal, blueAttack, blueDefense, blueCrit, blueStr, blueElmAttack, blueElmDef, blueElmEffc, bluePot, blueELM, blueRecovery, blueEvas, blueAcc blueLuck, blueGen, blueGenPow, blueWill, blueNinCost, blueNinjutsuCost, blueNinjutsuPower, blueDomPurity, blueDomDur, blueDomLethal, blueCurseRec, blueWeapon, blueShield, blueStun, blueWitherPer, blueHeal');
                    if (stat_max == 'redHeal') {
                        let currRedHp = parseInt($('#redHP').text(), 10)
                        let healAmount = parseInt(prompt('Healing Factor?'), 10)
                        currRedHp += healAmount;
                        $('#damage').text(`Red Recoverd ${healAmount} HP üñ§`)
                        $('#redHP').text(currRedHp)
                        return
                    } else if (stat_max == 'blueHeal') {
                        let currBlueHp = parseInt($('#blueHP').text(), 10)
                        let healAmount = parseInt(prompt('Healing Factor?'), 10)
                        currBlueHp += healAmount;
                        $('#damage').text(`Blue Recoverd ${healAmount} HP üñ§`)
                        $('#blueHP').text(currBlueHp)
                        return
                    }
                    let stat_type = prompt('Increase or Decrease');
                    let stat_number = parseFloat(prompt('By how much'));

                    switch (stat_max) {
                        case 'redAttack':
                            if (stat_type == 'Increase') {
                                redAttack = Math.floor(redAttack * (1 + stat_number));
                            } else {
                                redAttack = Math.floor(redAttack * (1 - stat_number));
                            }
                            break;
                        case 'redDefense':
                            if (stat_type == 'Increase') {
                                redDefense = Math.floor(redDefense * (1 + stat_number));
                            } else {
                                redDefense = Math.floor(redDefense * (1 - stat_number));
                            }
                            break;
                        case 'redCrit':
                            if (stat_type == 'Increase') {
                                redCrit = (redCrit * (1 + stat_number)).toFixed(2);
                            } else {
                                redCrit = (redCrit * (1 - stat_number)).toFixed(2);
                            }
                            break;
                        case 'redElmAttack':
                            if (stat_type == 'Increase') {
                                redElmAttack = Math.floor(redElmAttack * (1 + stat_number));
                            } else {
                                redElmAttack = Math.floor(redElmAttack * (1 - stat_number));
                            }
                            break;
                        case 'redUltNinCost':
                            if (stat_type == 'Increase') {
                                redNinCost = Math.floor(redNinCost * (1 + stat_number));
                            } else {
                                redNinCost = Math.floor(redNinCost * (1 - stat_number));
                            }
                            break;
                        case 'redElmDef':
                            if (stat_type == 'Increase') {
                                redElmDef = Math.floor(redElmDef * (1 + stat_number));
                            } else {
                                redElmDef = Math.floor(redElmDef * (1 - stat_number));
                            }
                            break;
                        case 'redElmEffc':
                            if (stat_type == 'Increase') {
                                redElmEffc = stat_number;
                            } else {
                                redElmEffc = stat_number;
                            }
                            break;
                        case 'redHp':
                            if (stat_type == 'Increase') {
                                redHp = Math.max(0, Math.floor(redHp * (1 + stat_number))); // Ensuring no negative values
                            } else {
                                redHp = Math.max(0, Math.floor(redHp * (1 - stat_number)));
                            }
                            break;
                        case 'redStr':
                            if (stat_type == 'Increase') {
                                redStrength = (redStrength * (1 + stat_number)).toFixed(2);
                            } else {
                                redStrength = (redStrength * (1 - stat_number)).toFixed(2);
                            }
                            break;
                        case 'redPot':
                            if (stat_type == 'Increase') {
                                redPotency = (redPotency * (1 + stat_number)).toFixed(2);
                            } else {
                                redPotency = (redPotency * (1 - stat_number)).toFixed(2);
                            }
                            break;
                        case 'redELM':
                            affinity = prompt('Change Affinity (Earth, Water, Fire, Wind, Lightning, Fighter, Grass, Dark)')
                            redELM = affinity
                            alert(`Red Affinity changed to ${redELM}`)
                            break;
                        case 'redRecovery':
                            if (stat_type == 'Increase') {
                                redRecovery = Math.floor(redRecovery + stat_number);
                                alert(`Red's chakra recovery increases to ${redRecovery}`)
                            } else {
                                redRecovery = Math.floor(redRecovery - stat_number);
                                alert(`Red's chakra recovery decreases to ${redRecovery}`)
                            }
                            break;
                        case 'redAcc':
                            if (stat_type == 'Increase') {
                                redAcc += stat_number
                            } else {
                                redAcc -= stat_number
                            }
                            break;
                        case 'redEvas':
                            if (stat_type == 'Increase') {
                                redEvas += stat_number
                            } else {
                                redEvas -= stat_number
                            }
                            break;
                        case 'redLuck':
                            if (stat_type == 'Increase') {
                                redLuck += stat_number
                            } else {
                                redLuck -= stat_number
                            }
                            break;
                        case 'redNinjutsuPower':
                            if (stat_type == 'Increase') {
                                redNenNinDmg = Math.floor(redNenNinDmg * (1 + stat_number));
                            } else {
                                redNenNinDmg = Math.floor(redNenNinDmg * (1 - stat_number));
                            }
                            break;
                        case 'redNinjutsuCost':
                            if (stat_type == 'Increase') {
                                redNenNinCost = Math.floor(redNenNinCost * (1 + stat_number));
                            } else {
                                redNenNinCost = Math.floor(redNenNinCost * (1 - stat_number));
                            }
                            break;

                        case 'redGen':
                            if (stat_type == 'Increase') {
                                redGen += stat_number
                            } else {
                                redGen -= stat_number
                            }
                            break;
                        case 'redGenPow':
                            if (stat_type == 'Increase') {
                                redGenPow += stat_number
                            } else {
                                redGenPow -= stat_number
                            }
                            break;
                        case 'redWill':
                            if (stat_type == 'Increase') {
                                redWill += stat_number
                            } else {
                                redWill -= stat_number
                            }
                            break;
                        case 'redStun':
                            if (stat_type == 'Increase') {
                                redStun += stat_number
                            } else {
                                redStun -= stat_number
                            }
                            alert('Stun increases')
                            break;
                        case 'blueAttack':
                            if (stat_type == 'Increase') {
                                blueAttack = Math.floor(blueAttack * (1 + stat_number));
                            } else {
                                blueAttack = Math.floor(blueAttack * (1 - stat_number));
                            }
                            break;
                        case 'blueDefense':
                            if (stat_type == 'Increase') {
                                blueDefense = Math.floor(blueDefense * (1 + stat_number));
                            } else {
                                blueDefense = Math.floor(blueDefense * (1 - stat_number));
                            }
                            break;
                        case 'blueCrit':
                            if (stat_type == 'Increase') {
                                blueCrit = (blueCrit * (1 + stat_number)).toFixed(2);
                            } else {
                                blueCrit = (blueCrit * (1 - stat_number)).toFixed(2);
                            }
                            break;
                        case 'blueElmAttack':
                            if (stat_type == 'Increase') {
                                blueElmAttack = Math.floor(blueElmAttack * (1 + stat_number));
                            } else {
                                blueElmAttack = Math.floor(blueElmAttack * (1 - stat_number));
                            }
                            break;
                        case 'blueElmDef':
                            if (stat_type == 'Increase') {
                                blueElmDef = Math.floor(blueElmDef * (1 + stat_number));
                            } else {
                                blueElmDef = Math.floor(blueElmDef * (1 - stat_number));
                            }
                            break;
                        case 'blueElmEffc':
                            if (stat_type == 'Increase') {
                                blueElmEffc = stat_number;
                            } else {
                                blueElmEffc = stat_number;
                            }
                            break;
                        case 'blueHp':
                            if (stat_type == 'Increase') {
                                blueHp = Math.max(0, Math.floor(blueHp * (1 + stat_number))); // Ensuring no negative values
                            } else {
                                blueHp = Math.max(0, Math.floor(blueHp * (1 - stat_number)));
                            }
                            break;
                        case 'blueStr':
                            if (stat_type == 'Increase') {
                                blueStrength = (blueStrength * (1 + stat_number)).toFixed(2);
                            } else {
                                blueStrength = (blueStrength * (1 - stat_number)).toFixed(2);
                            }
                            break;
                        case 'bluePot':
                            if (stat_type == 'Increase') {
                                bluePotency = (bluePotency * (1 + stat_number)).toFixed(2);
                            } else {
                                bluePotency = (bluePotency * (1 - stat_number)).toFixed(2);
                            }
                            break;
                        case 'blueELM':
                            affinity = prompt('Change Affinity (Earth, Water, Fire, Wind, Lightning, Fighter, Grass, Dark)')
                            blueELM = affinity
                            alert(`Red Affinity changed to ${blueELM}`)
                            break;
                        case 'blueRecovery':
                            if (stat_type == 'Increase') {
                                blueRecovery = Math.floor(blueRecovery + stat_number); // Corrected to use blueRecovery
                                alert(`Blue's chakra recovery increases to ${blueRecovery}`)
                            } else {
                                blueRecovery = Math.floor(blueRecovery - stat_number);
                                alert(`Blue's chakra recovery increases to ${blueRecovery}`)
                            }
                            break;
                        case 'blueAcc':
                            if (stat_type == 'Increase') {
                                blueAcc += stat_number
                            } else {
                                blueAcc -= stat_number
                            }
                            break;
                        case 'blueEvas':
                            if (stat_type == 'Increase') {
                                blueEvas += stat_number
                            } else {
                                blueEvas -= stat_number
                            }
                            break;
                        case 'blueLuck':
                            if (stat_type == 'Increase') {
                                blueLuck += stat_number
                            } else {
                                blueLuck -= stat_number
                            }
                            break;
                        case 'blueGen':
                            if (stat_type == 'Increase') {
                                blueGen += stat_number
                            } else {
                                blueGen -= stat_number
                            }
                            break;
                        case 'blueGenPow':
                            if (stat_type == 'Increase') {
                                blueGenPow += stat_number
                            } else {
                                blueGenPow -= stat_number
                            }
                            break;
                        case 'blueWill':
                            if (stat_type == 'Increase') {
                                blueWill += stat_number
                            } else {
                                blueWill -= stat_number
                            }
                            break;
                        case 'blueNinjutsuPower':
                            if (stat_type == 'Increase') {
                                blueNenNinDmg = Math.floor(blueNenNinDmg * (1 + stat_number));
                            } else {
                                blueNenNinDmg = Math.floor(blueNenNinDmg * (1 - stat_number));
                            }
                            break;

                        case 'blueNinjutsuCost':
                            if (stat_type == 'Increase') {
                                blueNenNinCost = Math.floor(blueNenNinCost * (1 + stat_number));
                            } else {
                                blueNenNinCost = Math.floor(blueNenNinCost * (1 - stat_number));
                            }
                            break;
                        case 'blueDomPurity':
                            if (stat_type == 'Increase') {
                                blueDomPurity += stat_number
                            } else {
                                blueDomPurity -= stat_number
                            }
                            break;
                        case 'redDomPurity':
                            if (stat_type == 'Increase') {
                                redDomPurity += stat_number
                            } else {
                                redDomPurity -= stat_number
                            }
                            break;
                        case 'redDomDur':
                            if (stat_type == 'Increase') {
                                redDomDuration += stat_number
                            } else {
                                redDomDuration -= stat_number
                            }
                            break;
                        case 'blueDomDur':
                            if (stat_type == 'Increase') {
                                blueDomDuration += stat_number
                            } else {
                                blueDomDuration -= stat_number
                            }
                            break;
                        case 'blueDomLethal':
                            if (stat_type == 'Increase') {
                                blueDomLethal = Math.floor(blueDomLethal * (1 + stat_number));
                            } else {
                                blueDomLethal = Math.floor(blueDomLethal * (1 - stat_number));
                            }
                            break;
                        case 'redDomLethal':
                            if (stat_type == 'Increase') {
                                redDomLethal = Math.floor(redDomLethal * (1 + stat_number));
                            } else {
                                redDomLethal = Math.floor(redDomLethal * (1 - stat_number));
                            }
                            break;
                        case 'redCurseRec':
                            if (stat_type == 'Increase') {
                                redCurseRec += stat_number
                            } else {
                                redCurseRec -= stat_number
                            }
                            alert(`Curse Recovery is ${redCurseRec}`)
                            break;
                        case 'blueCurseRec':
                            if (stat_type == 'Increase') {
                                blueCurseRec += stat_number
                            } else {
                                blueCurseRec -= stat_number
                            }
                            alert(`Curse Recovery is ${blueCurseRec}`)
                            break;
                        case 'redWeapon':
                            if (stat_type == 'Increase') {
                                redWeapon = Math.floor(redWeapon * (1 + stat_number));
                            } else {
                                redWeapon = Math.floor(redWeapon * (1 - stat_number));
                            }
                            break;
                        case 'redShield':
                            if (stat_type == 'Increase') {
                                redShield = Math.floor(redShield * (1 + stat_number));
                            } else {
                                redShield = Math.floor(redShield * (1 - stat_number));
                            }
                            break;
                        case 'blueWeapon':
                            if (stat_type == 'Increase') {
                                blueWeapon = Math.floor(blueWeapon * (1 + stat_number));
                            } else {
                                blueWeapon = Math.floor(blueWeapon * (1 - stat_number));
                            }
                            break;
                        case 'blueShield':
                            if (stat_type == 'Increase') {
                                blueShield = Math.floor(blueShield * (1 + stat_number));
                            } else {
                                blueShield = Math.floor(blueShield * (1 - stat_number));
                            }
                            break;
                        case 'blueStun':
                            if (stat_type == 'Increase') {
                                blueStun += stat_number
                            } else {
                                blueStun -= stat_number
                            }
                            alert('Stun increases')
                            break;
                        case 'redWitherPer':
                            if (stat_type == 'Increase') {
                                redWeaponCrit += stat_number
                            } else {
                                redWeaponCrit -= stat_number
                            }
                            break;
                        case 'blueWitherPer':
                            if (stat_type == 'Increase') {
                                blueWeaponCrit += stat_number
                                alert(`here it is ${blueWeaponCrit}`)
                            } else {
                                blueWeaponCrit -= stat_number
                            }
                            break;
                        default:
                            alert('Invalid stat');
                            break;
                    }

                }

                $('#redHp').text(redHp);
                $('#redAttack').text(redAttack);
                $('#redDefense').text(redDefense);
                $('#redCrit').text(redCrit);
                $('#redStr').text(redStrength);
                $('#redELM').text(redELM);
                $('#redElmAttack').text(redElmAttack);
                $('#redElmDef').text(redElmDef);
                $('#redElmEffc').text(redElmEffc);
                $('#redPot').text(redPotency);
                $('#redGen').text(redGen)
                $('#redGenPow').text(redGenPow)
                $('#redWill').text(redWill)
                $('#redAcc').text(redAcc)
                $('#redEvas').text(redEvas)
                $('#redLuck').text(redLuck)
                $('#redNinPow').text(redNenNinDmg)
                $('#redUltPow').text(redNinPower)
                $('#redcost1').text(redNenNinCost)
                $('#redcost2').text(redNinCost)
                $('#red_dom_purity').text(redDomPurity)
                $('#red_dom_lethal').text(redDomLethal)
                $('#red_dom_duration').text(redDomDuration)
                $('#red_dom_cost').text(redDomCost)
                $('#redWeaponCrit').text(redWeaponCrit)
                $('#redWeapon').text(redWeapon)
                $('#redShield').text(redShield)
                $('#redWeapon').text(redWeapon)

                $('#blueHp').text(blueHp);
                $('#blueAttack').text(blueAttack);
                $('#blueDefense').text(blueDefense);
                $('#blueCrit').text(blueCrit);
                $('#blueStr').text(blueStrength)
                $('#blueAcc').text(blueAcc)
                $('#blueEvas').text(blueEvas)
                $('#bluePot').text(bluePotency);
                $('#blueELM').text(blueELM);
                $('#blueElmAttack').text(blueElmAttack);
                $('#blueElmDef').text(blueElmDef);
                $('#blueElmEffc').text(blueElmEffc);
                $('#blueGen').text(blueGen)
                $('#blueGenPow').text(blueGenPow)
                $('#blueWill').text(blueWill)
                $('#blueLuck').text(blueLuck)
                $('#blueNinPow').text(blueNenNinDmg)
                $('#blueUltPow').text(blueNinPower)
                $('#bluecost1').text(blueNenNinCost)
                $('#bluecost2').text(blueNinCost)
                $('#blue_dom_purity').text(blueDomPurity)
                $('#blue_dom_lethal').text(blueDomLethal)
                $('#blue_dom_duration').text(blueDomDuration)
                $('#blue_dom_cost').text(blueDomCost)
                $('#blueWeaponCrit').text(blueWeaponCrit)
                $('#blueShield').text(blueShield)
                $('#blueWeapon').text(blueWeapon)

            } else {
                $('#damage').text('Fail');
            }
        }



        function triggerTsukuyomiExplosion(defender) {
            let fighter1 = $('.hi1').text();
            let fighter2 = $('.hi2').text();
            alert(`${fighter1} vs ${fighter2}`)
            const weightedNumbers = [
                5,
                6, 6,
                7, 7, 7,
                8, 8,
                9
            ];

            let randomIndex = Math.floor(Math.random() * weightedNumbers.length);
            if (fighter1 == 'Shino' || fighter2 == 'Shino') {
                randomIndex = 8
                alert(`shino boom boom booom! ${randomIndex}`)
            }
            let tsuMulti = weightedNumbers[randomIndex];
            if (defender === 'red') {
                let power = parseInt($('#blueChakra').text(), 10)
                let explosionDamage = power * tsuMulti;
                let currRedHp = parseInt($('#redHP').text(), 10);
                $('#redHP').text(currRedHp - explosionDamage);
                chargeCurse('red', explosionDamage)
                alert('Tsukuyomi explodes! Red takes ' + explosionDamage + ' damage.');
            } else if (defender === 'blue') {
                let power = parseInt($('#redChakra').text(), 10)
                let explosionDamage = power * tsuMulti;
                let currBlueHp = parseInt($('#blueHP').text(), 10);
                chargeCurse('blue', explosionDamage)
                $('#blueHP').text(currBlueHp - explosionDamage);
                alert('Tsukuyomi explodes! Blue takes ' + explosionDamage + ' damage.');
            }
            clearStatusEffect(defender, 'Tsukuyomi'); // Clear the Tsukuyomi status effect after it explodes
        }

        let roundCounters = { red: {}, blue: {} }; // Track round counters
        let tsukuyomiCounters = { red: 0, blue: 0 }; // Track Tsukuyomi specific counters
        let kotoamatsukamiCounters = { red: 0, blue: 0 }; // Track Kotoamatsukami specific counters



        function genjutsuAttack(genjutsu, willpower, color) {
            const multiplier = 1.7; // Genjutsu multiplier
            const scalingFactor = 0.678; // Derived scaling factor from willpower

            let hitChance = (genjutsu * multiplier) / (genjutsu * multiplier + willpower * scalingFactor);
            hitChance = Math.min(Math.max(hitChance, 0), 1)
            const isHit = Math.random() < hitChance;
            console.log('Hit chance', hitChance)

            if (isHit) {
                alert('"Youre Already Under My GenJutsu.."')
                let statusEffect = prompt("Choose a status effect to apply: Darkness (6), Silence (6), Zombie (8), Ultima (15), Flare(15), Tsukuyomi (20), Kotoamatsukami (30)");
                applyStatusEffect(color, statusEffect); // Apply effect to the defender
            } else {
                alert('GenJutsu of that level doesnt work on me')
            }
        }
        const evasion = ["Projection-Sorcery", 'Body-Manipulation', 'Shark-Transformation'];
        const attacking = ['Mutation', '8th-Gate', 'Rumbling', 'Ninety-Ninth-Hand', 'Cursed-Blade'];
        const defense = ["Reverse", 'Veil', 'Simple-Domain',];
        const critical = ['Blade', 'Thunderclap-Veil', "Muscular-Expansion", 'Gorilla-Mode'];
        const strength = ['Polymorphic'];
        const potency = ["Disaster-Flames", "Hairpin", "Resonance", 'Disaster-Bolts'];
        const magic_defense = ["Simple-Barrier", 'Rage-Blast',];
        const magic_attack = ['Albatross', 'Electro-Strike-Manipulation', 'Seven-Spectrum']
        const abusive = ["Idle-Transfiguration", "Brain-Manipulation"];
        const damage = ["Dismantle", 'Granite-Blast', 'Convergence', 'Cursed-Bee-Bomb']; //** NEW please add me**
        const luck = ["Miracle"];
        const weapon = ['Overtime', 'Devil-Transformation', 'Soul-Forge']
        const shield = []
        const chakra_cost = ["Falling-Blossom-Emotion"];
        const genjutsu = [] //** NEW please add me**
        const genPower = ['Black-Bird-Manipulation'] //** NEW please add me**
        const drain = ['Limitless-Reversal:'] //** NEW please add me**
        const recovery = ['Cursed-Gyuuki', 'Reverse-Flow-Recovery', 'Cursed-Kyuubi']
        const stunn = ['Flash', "Flying-Rajin", 'God‚Äôs-Accomplice']
        const misc = ["Idle-Death-Gamble", 'Hollow-Wicker-Basket', 'Whispering-Dominion',];
        const domDuration1 = ['Domain-Amplification']
        const ninjutsuStr = ['Yellow-Flash']
        const toji = ['Inventory-Curse']
        const black = ['Black-Flash']


        let blackTech;
        function applyCurseTech(attacker, curseWord, duration, cost, amount) {
            let curse = curseWord.split(" ")[0]
            console.log(`${attacker} has used the ${curse} curse technique! lasts ${duration} turns and a cost of ${cost} increased by ${amount}`)
            let currBlueCurse = parseInt($('#blueCurrCurse').text(), 10)
            let currRedCurse = parseInt($('#redCurrCurse').text(), 10)
            let currBlueHp = parseInt($('#blueHP').text(), 10);
            let currRedHp = parseInt($('#redHP').text(), 10);
            let currBlueChakra = parseInt($('#blueChakra').text(), 10);
            let currRedChakra = parseInt($('#redChakra').text(), 10);



            if (attacker == 'red') {
                if (currRedCurse < cost) {
                    alert('Not enough curse energy')
                    return
                } else {
                    currRedCurse -= cost;
                    $('#redCurrCurse').text(currRedCurse)
                    console.log('red has casted a curse for this duration', duration)
                }

                ///////// LONG IF CHAIN ADD HERE//////////

                if (recovery.includes(curse)) {
                    redRecovery += amount
                }
                if (ninjutsuStr.includes(curse)) {
                    redNenNinDmg += amount
                }
                if (stunn.includes(curse)) {
                    redStun += amount
                }
                if (weapon.includes(curse)) {
                    redWeapon += amount
                }
                if (shield.includes(curse)) {
                    redShield += amount
                }
                if (evasion.includes(curse)) {
                    redEvas += amount
                    $('#redEvas').text(redEvas)
                }
                if (damage.includes(curse)) {
                    currBlueHp -= amount;
                    $('#blueHP').text(currBlueHp);
                }
                if (genjutsu.includes(curse)) {
                    redGen += amount;
                    $('#redGen').text(redGen)
                }
                if (genPower.includes(curse)) {
                    redGenPow += amount;
                    $('#redGenPow').text(redGenPow)
                    alert('oh yeyey boi')
                }
                if (drain.includes(curse)) {
                    currBlueChakra -= amount;
                    $('#blueChakra').text(currBlueChakra)
                }
                if (abusive.includes(curse)) {
                    buff(100, 'und', 0, 0, 'MISC', 'no', 'no')
                }
                if (attacking.includes(curse)) {
                    redAttack += amount;
                    $('#redAttack').text(redAttack);
                }
                if (defense.includes(curse)) {
                    redDefense += amount
                    $('#redDefense').text(redDefense);
                }
                if (critical.includes(curse)) {
                    redCrit += amount;
                    $('#redCrit').text(redCrit);
                }
                if (strength.includes(curse)) {
                    redStrength += amount;
                    $('#redStr').text(redStrength);
                }
                if (potency.includes(curse)) {
                    redPotency += amount
                    $('#redPot').text(redPotency);
                }
                if (magic_defense.includes(curse)) {
                    redElmDef += amount
                    $('#redElmDef').text(redElmDef);
                }
                if (magic_attack.includes(curse)) {
                    redElmAttack += amount
                    $('#redElmAttack').text(redElmAttack);
                }
                if (luck.includes(curse)) {
                    redLuck += amount
                    $('#redLuck').text(redLuck)
                }
                if (chakra_cost.includes(curse)) {
                    redNenNinCost -= amount
                    $('#redNinPow').text(redNenNinCost)
                }
                if (domDuration1.includes(curse)) {
                    redDomDuration += amount
                    $('#red_dom_duration').text(redDomDuration)
                }
                if (toji.includes(curse)) {
                    let weapon = prompt('Split Soul Katana, Inverted Spear of Heaven,  Chain of a Thousand Miles, Playful Cloud')
                    if (weapon == 'Split Soul Katana') {
                        redWeaponCrit = .70
                        redWeaponCurse = 'Shield'
                        redWeaponAmount = 10
                    }
                    if (weapon == 'Inverted Spear of Heaven') {
                        redWeaponCrit = .50
                        redWeaponCurse = 'Curse'
                        redWeaponAmount = 10
                    }
                    if (weapon == 'Chain of a Thousand Miles') {
                        redWeaponCrit = .50
                        redWeaponCurse = 'Magic'
                        redWeaponAmount = 10
                    }
                    if (weapon == 'Playful Cloud') {
                        redWeaponCrit = .50
                        redWeaponCurse = 'Attack'
                        redWeaponAmount = 10
                    }
                    $('.redWeaponCurse').text(redWeaponCurse)
                    $('#redWeaponCrit').text(redWeaponCrit)
                }
                if (black.includes(curse)) {
                    blackTech = prompt('Black-Flash | Divergent-Fist | Boogie-Woogie')
                    if (blackTech == 'Black-Flash') {
                        redCrit = .85;
                        redStrength = 2.5
                        duration = 2;
                        redAcc += 5;
                        $('#redCrit').text(redCrit)
                        $('#redStr').text(redStrength)
                    } else if (blackTech == 'Divergent-Fist') {
                        redStun = .75;
                        currRedCurse -= 9
                        $('#redCurrCurse').text(currRedCurse)
                        alert(`Stun rate has increased to ${redStun}`)
                        duration = 6
                    } else {
                        redEvas += 100
                        duration = 2
                        $('#redEvas').text(redEvas)
                    }
                }
                /////////// END OF IF CHAIN /////////////
                redCurses.push({ name: curse, turnsLeft: duration, amount })
                $('#redCurseUi').text(curse)
                console.log('here are red curses array', redCurses)
            } else {
                if (currBlueCurse < cost) {
                    alert('Not enough curse energy')
                    return
                } else {
                    currBlueCurse -= cost;
                    $('#blueCurrCurse').text(currBlueCurse)
                }
                ///////// LONG IF CHAIN ADD HERE//////////
                if (recovery.includes(curse)) {
                    blueRecovery += amount
                }
                if (stunn.includes(curse)) {
                    blueStun += amount
                }
                if (ninjutsuStr.includes(curse)) {
                    blueNenNinDmg += amount
                }
                if (weapon.includes(curse)) {
                    blueWeapon += amount
                }
                if (shield.includes(curse)) {
                    Shield += amount
                }
                if (evasion.includes(curse)) {
                    blueEvas += amount
                    $('#blueEvas').text(blueEvas)
                }
                if (abusive.includes(curse)) {
                    buff(100, 'und', 0, 0, 'MISC', 'no', 'no')
                }
                if (attacking.includes(curse)) {
                    blueAttack += amount;
                    $('#blueAttack').text(blueAttack);
                }
                if (defense.includes(curse)) {
                    blueDefense += amount
                    $('#blueDefense').text(blueDefense);
                }
                if (critical.includes(curse)) {
                    blueCrit += amount;
                    $('#blueCrit').text(blueCrit);
                }
                if (strength.includes(curse)) {
                    blueStrength += amount;
                    $('#blueStr').text(blueStrength);
                }
                if (potency.includes(curse)) {
                    bluePotency += amount
                    $('#bluePot').text(bluePotency);
                }
                if (magic_defense.includes(curse)) {
                    blueElmDef += amount
                    $('#blueElmDef').text(blueElmDef);
                }
                if (magic_attack.includes(curse)) {
                    blueElmAttack += amount
                    $('#blueElmAttack').text(blueElmAttack);
                }
                if (luck.includes(curse)) {
                    blueLuck += amount
                    $('#blueLuck').text(blueLuck)
                }
                if (chakra_cost.includes(curse)) {
                    blueNenNinCost -= amount
                    $('#blueNinPow').text(blueNenNinCost)
                }
                if (damage.includes(curse)) {
                    currRedHp -= amount;
                    $('#redHP').text(currRedHp);
                }
                if (genjutsu.includes(curse)) {
                    blueGen += amount;
                    $('#blueGen').text(blueGen)
                }
                if (genPower.includes(curse)) {
                    blueGenPow += amount;
                    $('#blueGenPow').text(blueGenPow)
                }
                if (drain.includes(curse)) {
                    currRedChakra -= amount;
                    $('#redChakra').text(currRedChakra)
                }
                if (domDuration1.includes(curse)) {
                    blueDomDuration += amount
                    $('#blue_dom_duration').text(blueDomDuration)
                }
                if (toji.includes(curse)) {
                    let weapon = prompt('Split Soul Katana, Inverted Spear of Heaven,  Chain of a Thousand Miles, Playful Cloud')
                    if (weapon == 'Split Soul Katana') {
                        blueWeaponCrit = .70
                        blueWeaponCurse = 'Shield'
                        blueWeaponAmount = 10
                    }
                    if (weapon == 'Inverted Spear of Heaven') {
                        blueWeaponCrit = .50
                        blueWeaponCurse = 'Curse'
                        blueWeaponAmount = 10
                    }
                    if (weapon == 'Chain of a Thousand Miles') {
                        blueWeaponCrit = .50
                        blueWeaponCurse = 'Magic'
                        blueWeaponAmount = 10
                    }
                    if (weapon == 'Playful Cloud') {
                        blueWeaponCrit = .50
                        blueWeaponCurse = 'Attack'
                        blueWeaponAmount = 10
                    }
                    $('.blueWeaponCurse').text(blueWeaponCurse)
                    $('#blueWeaponCrit').text(blueWeaponCrit)
                }
                if (black.includes(curse)) {
                    blackTech = prompt('Black-Flash | Divergent-Fist | Boogie-Woogie')
                    if (blackTech == 'Black-Flash') {
                        blueCrit = .85;
                        blueStrength = 2.5
                        duration = 2;
                        blueAcc += 5;
                        $('#blueCrit').text(blueCrit)
                        $('#blueStr').text(blueStrength)
                    } else if (blackTech == 'Divergent-Fist') {
                        blueStun = .75;
                        currBlueCurse -= 9
                        $('#blueCurrCurse').text(currBlueCurse)
                        alert(`Stun rate has increased to ${blueStun}`)
                        duration = 6
                    } else {
                        blueEvas += 100
                        duration = 2
                        $('#blueEvas').text(blueEvas)
                    }
                }
                /////////// END OF IF CHAIN /////////////
                blueCurses.push({ name: curse, turnsLeft: duration, amount })
                $('#blueCurseUi').text(curse)
            }
        }
        // Function to remove a curse for a player
        function removeCurse(player, curse) {
            let curses = player === 'red' ? redCurses : blueCurses;
            const curseIndex = curses.findIndex(c => c.name === curse);
            if (curseIndex === -1) {
                console.log(`${curse} is not active on Player ${player.toUpperCase()}.`);
                return;
            }

            const amount = curses[curseIndex].amount;

            if (player == 'red') {
                ///////// LONG IF CHAIN ADD HERE//////////
                if (recovery.includes(curse)) {
                    redRecovery -= amount
                }
                if (ninjutsuStr.includes(curse)) {
                    redNenNinDmg -= amount
                }
                if (stunn.includes(curse)) {
                    redStun -= amount
                }
                if (weapon.includes(curse)) {
                    redWeapon -= amount
                }
                if (evasion.includes(curse)) {
                    redEvas -= amount
                    $('#redEvas').text(redEvas)
                }
                if (attacking.includes(curse)) {
                    redAttack -= amount;
                    $('#redAttack').text(redAttack);
                }
                if (defense.includes(curse)) {
                    redDefense -= amount;
                    $('#redDefense').text(redDefense);
                }
                if (critical.includes(curse)) {
                    redCrit -= amount;
                    $('#redCrit').text(redCrit);
                }
                if (strength.includes(curse)) {
                    redStrength -= amount;
                    $('#redStr').text(redStrength);
                }
                if (potency.includes(curse)) {
                    redPotency -= amount;
                    $('#redPot').text(redPotency);
                }
                if (magic_defense.includes(curse)) {
                    redElmDef -= amount;
                    $('#redElmDef').text(redElmDef);
                }
                if (magic_attack.includes(curse)) {
                    redElmAttack -= amount;
                    $('#redElmAttack').text(redElmAttack);
                }
                if (luck.includes(curse)) {
                    redLuck -= amount;
                    $('#redLuck').text(redLuck);
                }
                if (chakra_cost.includes(curse)) {
                    redNenNinCost += amount;
                    $('#redNinPow').text(redNenNinCost);
                }
                if (genjutsu.includes(curse)) {
                    redGen -= amount;
                    $('#redGen').text(redGen);
                }
                if (genPower.includes(curse)) {
                    redGenPow -= amount;
                    $('#redGenPow').text(redGenPow);
                }
                if (domDuration1.includes(curse)) {
                    redDomDuration -= amount;
                    $('#red_dom_duration').text(redDomDuration);
                }
                if (black.includes(curse)) {
                    if (blackTech == 'Black-Flash') {
                        redCrit = .23;
                        redStrength = 1.65
                        redAcc -= 4;
                    } else if (blackTech == 'Divergent-Fist') {
                        redStun = .05
                    } else {
                        redEvas -= 100;
                    }
                    $('#redEvas').text(redEvas)
                    $('#redCrit').text(redCrit)
                    $('#redStr').text(redStrength)
                }

            } else {
                ///////// BLUE PLAYER CURSE REMOVAL /////////
                if (recovery.includes(curse)) {
                    blueRecovery -= amount;
                }
                if (ninjutsuStr.includes(curse)) {
                    blueNenNinDmg -= amount
                }
                if (weapon.includes(curse)) {
                    blueWeapon -= amount;
                }
                if (stunn.includes(curse)) {
                    blueStun -= amount
                }
                if (evasion.includes(curse)) {
                    blueEvas -= amount;
                    $('#blueEvas').text(blueEvas);
                }
                if (attacking.includes(curse)) {
                    blueAttack -= amount;
                    $('#blueAttack').text(blueAttack);
                }
                if (defense.includes(curse)) {
                    blueDefense -= amount;
                    $('#blueDefense').text(blueDefense);
                }
                if (critical.includes(curse)) {
                    blueCrit -= amount;
                    $('#blueCrit').text(blueCrit);
                }
                if (strength.includes(curse)) {
                    blueStrength -= amount;
                    $('#blueStr').text(blueStrength);
                }
                if (potency.includes(curse)) {
                    bluePotency -= amount;
                    $('#bluePot').text(bluePot);
                }
                if (magic_defense.includes(curse)) {
                    blueElmDef -= amount;
                    $('#blueElmDef').text(blueElmDef);
                }
                if (magic_attack.includes(curse)) {
                    blueElmAttack -= amount;
                    $('#blueElmAttack').text(blueElmAttack);
                }
                if (luck.includes(curse)) {
                    blueLuck -= amount;
                    $('#blueLuck').text(blueLuck);
                }
                if (chakra_cost.includes(curse)) {
                    blueNenNinCost += amount;
                    $('#blueNinPow').text(blueNenNinCost);
                }
                if (genjutsu.includes(curse)) {
                    blueGen -= amount;
                    $('#blueGen').text(blueGen);
                }
                if (genPower.includes(curse)) {
                    blueGenPow -= amount;
                    $('#blueGenPow').text(blueGenPow);
                }
                if (drain.includes(curse)) {
                    // Handle chakra drain reversal here if necessary
                }
                if (domDuration1.includes(curse)) {
                    blueDomDuration -= amount;
                    $('#blue_dom_duration').text(blueDomDuration);
                }
                if (black.includes(curse)) {
                    if (blackTech == 'Black-Flash') {
                        blueCrit = .23;
                        blueStrength = 1.65
                        blueAcc -= 4;
                    } else if (blackTech == 'Divergent-Fist') {
                        blueStun = .05
                    } else {
                        blueEvas -= 100;
                    }
                    $('#blueEvas').text(blueEvas)
                    $('#blueCrit').text(blueCrit)
                    $('#blueStr').text(blueStrength)
                }
            }

            // Remove the curse from the array
            curses.splice(curseIndex, 1);
            player === 'red' ? $('#redCurseUi').text('') : $('#blueCurseUi').text('');
        }


        function applyStatusEffect(defender, statusEffect) {
            let duration = 4; // Default duration for all effects
            if (statusEffect == 'Ultima' || statusEffect == 'Flare') {
                duration = 2
            } else if (statusEffect == 'Confusion') {
                duration = 4
            } else if (statusEffect == 'Tsukuyomi') {
                duration = 7; // Tsukuyomi takes 6 rounds to trigger
                tsukuyomiCounters[defender] = 0; // Start Tsukuyomi counter at 0
            } else if (statusEffect == 'Kotoamatsukami') {
                duration = 20;
                kotoamatsukamiCounters[defender] = 0;
            }

            if (defender === 'red') {
                redStatus.push(statusEffect);
                roundCounters.red[statusEffect] = duration; // Set duration for this effect
                $('#redStatus').show().text(redStatus.join(', '));
            } else if (defender === 'blue') {
                blueStatus.push(statusEffect);
                roundCounters.blue[statusEffect] = duration; // Set duration for this effect
                $('#blueStatus').show().text(blueStatus.join(', '));
            }
            if (statusEffect == 'Izanagi') {
                const randomValue = Math.random();
                let chance = randomValue < 0.5;
                if (chance) {
                    alert("Reality will be rewritten...");
                    buff(100, 'und', 0, 0, 'MISC', 'no', 'no')
                } else {
                    alert("Failure!");
                }
            }
        }
        function endRound() {
            // Update round counters for each player's status effects
            for (let status of Object.keys(roundCounters.red)) {
                roundCounters.red[status]--;
                if (roundCounters.red[status] === 0) {
                    clearStatusEffect('red', status);
                }
            }

            for (let status of Object.keys(roundCounters.blue)) {
                roundCounters.blue[status]--;
                if (roundCounters.blue[status] === 0) {
                    clearStatusEffect('blue', status);
                }
            }
            [redCurses, blueCurses].forEach((curses, index) => {
                curses.forEach(curse => {
                    curse.turnsLeft--;
                    console.log(curse.turnsLeft)
                    if (curse.turnsLeft <= 0) {
                        console.log('time to call the end')
                        removeCurse(index === 0 ? 'red' : 'blue', curse.name);
                    }
                });
            });
            if (redStatus.includes('Tsukuyomi')) {
                tsukuyomiCounters.red++;
                console.log('counter', tsukuyomiCounters.red)
                if (tsukuyomiCounters.red >= 6) {
                    triggerTsukuyomiExplosion('red');
                }
            }
            if (blueStatus.includes('Tsukuyomi')) {
                tsukuyomiCounters.blue++;
                console.log('counter', tsukuyomiCounters.blue)
                if (tsukuyomiCounters.blue >= 6) {
                    triggerTsukuyomiExplosion('blue');
                }
            }
            // Check and update Kotoamatsukami effects for Red
            if (redStatus.includes('Kotoamatsukami')) {
                kotoamatsukamiCounters.red++;

                if (kotoamatsukamiCounters.red === 4) {
                    // 50% chance for redEvas to be set to 2
                    if (Math.random() < 0.5) {
                        redEvas = 2; // Set Red's evasion to 2
                        alert('Red\'s evasive movements have been compromised, evasion reduced to ' + redEvas + ' due to Kotoamatsukami.');
                        $('#redEvas').text(redEvas);
                    } else {
                        redWill = 0;
                        alert('Red has lost the will to fight, willpower dropped to ' + redWill + ' due to Kotoamatsukami.');
                        $('#redWill').text(redWill)
                    }
                } else if (kotoamatsukamiCounters.red === 10) {
                    // 50% chance to reduce redAttack by 25%
                    if (Math.random() < 0.5) {
                        redAttack = Math.round(redAttack * 0.85)
                        alert('Red\'s attack power has been reduced by 15% due to Kotoamatsukami.');
                        $('#redAttack').text(redAttack);
                    } else {
                        // 50% chance to reduce redElmAttack by 15%
                        redElmAttack = Math.round(redElmAttack * .85) // Reduce Red's elemental attack by 25%
                        alert('Red\'s elemental attack power has been reduced by 25% due to Kotoamatsukami.');
                        $('#redElmAttack').text(redElmAttack);
                    }
                } else if (kotoamatsukamiCounters.red === 14) {
                    // 50% chance to halve redAcc
                    if (Math.random() < 0.5) {
                        redAcc = Math.round(redAcc /= 2); // Halve Red's accuracy
                        alert('Red\'s perception is clouded, accuracy halved due to Kotoamatsukami.');
                        $('#redAcc').text(redAcc);
                    } else {
                        // 50% chance to halve redRecovery
                        redRecovery = Math.round(redRecovery /= 2); // Halve Red's recovery
                        alert('Red\'s recovery ability is impaired, recovery halved due to Kotoamatsukami.');
                        $('#redRecovery').text(redRecovery);
                    }
                } else if (kotoamatsukamiCounters.red === 20) {
                    alert('Red\'s mind has been fully controlled by Kotoamatsukami!');
                    buff(100, 'und', 0, 0, 'MISC', 'no', 'no')
                    clearStatusEffect('red', 'Kotoamatsukami'); // Clear the Kotoamatsukami status effect from Red
                }
            }


            // Check and update Kotoamatsukami effects for Blue
            // Check and update Kotoamatsukami effects for Blue
            if (blueStatus.includes('Kotoamatsukami')) {
                kotoamatsukamiCounters.blue++;

                if (kotoamatsukamiCounters.blue === 4) {

                    if (Math.random() < 0.5) {
                        blueEvas = 2; // Set Blue's evasion to 2
                        alert('Blue\'s evasive movements have been compromised, evasion reduced to ' + blueEvas + ' due to Kotoamatsukami.');
                        $('#blueEvas').text(blueEvas);
                    } else {
                        blueWill = 0;
                        alert('Blue has lost the will to fight, willpower dropped to ' + blueWill + ' due to Kotoamatsukami.');
                        $('#blueWill').text(blueWill)
                    }
                } else if (kotoamatsukamiCounters.blue === 10) {
                    // 50% chance to reduce blueAttack by 25%
                    if (Math.random() < 0.5) {
                        blueAttack = Math.round(blueAttack *= 0.85); // Reduce Blue's attack by 25%
                        alert('Blue\'s attack power has been reduced by 15% due to Kotoamatsukami.');
                        $('#blueAttack').text(blueAttack);
                    } else {
                        // 50% chance to reduce blueElmAttack by 25%
                        blueElmAttack = Math.Round(blueElmAttack *= .85); // Reduce Blue's elemental attack by 25%
                        alert('Blue\'s elemental attack power has been reduced by 15% due to Kotoamatsukami.');
                        $('#blueElmAttack').text(blueElmAttack);
                    }
                } else if (kotoamatsukamiCounters.blue === 14) {
                    // 50% chance to halve blueAcc
                    if (Math.random() < 0.5) {
                        blueAcc = Math.round(blueAcc /= 2); // Halve Blue's accuracy
                        alert('Blue\'s accuracy has fallen by half due to Kotoamatsukami.');
                        $('#blueAcc').text(blueAcc);
                    } else {
                        // 50% chance to halve blueRecovery
                        blueRecovery = Math.round(blueRecovery /= 2); // Halve Blue's recovery
                        alert('Blue\'s recovery ability is impaired, recovery halved due to Kotoamatsukami.');
                        $('#blueRecovery').text(blueRecovery);
                    }
                } else if (kotoamatsukamiCounters.blue === 20) {
                    alert('Blue\'s mind has been fully controlled by Kotoamatsukami!');
                    buff(100, 'und', 0, 0, 'MISC', 'no', 'no')
                    clearStatusEffect('blue', 'Kotoamatsukami'); // Clear the Kotoamatsukami status effect from Blue
                }
            }
        }

        function clearStatusEffect(defender, statusEffect) {
            if (defender === 'red') {
                redStatus = redStatus.filter(status => status !== statusEffect); // Remove effect
                delete roundCounters.red[statusEffect]; // Remove duration
                $('#redStatus').show().text(redStatus.join(', ')); // Update UI
                resetStats('red', statusEffect); // Reset stats when status effect ends

            } else if (defender === 'blue') {
                blueStatus = blueStatus.filter(status => status !== statusEffect); // Remove effect
                delete roundCounters.blue[statusEffect]; // Remove duration
                $('#blueStatus').show().text(blueStatus.join(', ')); // Update UI
                resetStats('blue', statusEffect); // Reset stats when status effect ends
            }
        }

        let originalBlueRecovery = blueRecovery
        let originalRedRecovery = redRecovery
        let originalBlueAttack = blueAttack
        let originalRedAttack = redAttack
        let originalRedMagic = redElmAttack
        let originalBlueMagic = blueElmAttack

        function resetStats(defender, statusEffect) {
            console.log('no reset')
        }
        const elementalWeaknesses = {
            Water: { strongAgainst: ['Fire', 'Earth', 'Fighter'], weakAgainst: ['Lightning', 'Grass', 'Fairy'] },
            Fire: { strongAgainst: ['Wind', 'Grass', 'Fairy'], weakAgainst: ['Water', 'Earth', 'Ghost'] },
            Wind: { strongAgainst: ['Water', 'Lightning', 'Ghost'], weakAgainst: ['Earth', 'Fire', 'Fairy'] },
            Lightning: { strongAgainst: ['Water', 'Grass', 'Ghost'], weakAgainst: ['Earth', 'Fighter', 'Wood'] },
            Earth: { strongAgainst: ['Fire', 'Lightning', 'Fairy'], weakAgainst: ['Water', 'Grass', 'Wood'] },
            Grass: { strongAgainst: ['Water', 'Earth', 'Wood'], weakAgainst: ['Fire', 'Lightning', 'Ghost'] },
            Fighter: { strongAgainst: ['Dark', 'Grass', 'Sage'], weakAgainst: ['Lightning', 'Water', 'Ghost'] },
            Dark: { strongAgainst: ['Grass', 'Water', 'Sage'], weakAgainst: ['Fairy', 'Fire', 'Ghost'] },
            Fairy: { strongAgainst: ['Dark', 'Fighter', 'Ghost'], weakAgainst: ['Fire', 'Wind', 'Earth'] },
            Ghost: { strongAgainst: ['Fighter', 'Sage', 'Dark'], weakAgainst: ['Fairy', 'Wind', 'Lightning'] },
            Wood: { strongAgainst: ['Water', 'Earth', 'Wind'], weakAgainst: ['Fire', 'Grass', 'Lightning'] },
            psychic: { strongAgainst: ['Sage'], weakAgainst: [] },
            sage: { weakAgainst: ['Fighter', 'Dark', 'Ghost', 'Psychic'] }
        };

        function checkWeakness(attackerElement, defenderElement) {
            const weaknesses = elementalWeaknesses[attackerElement];
            return weaknesses.strongAgainst.includes(defenderElement);
        }

        function checkResistance(attackerElement, defenderElement) {
            const weaknesses = elementalWeaknesses[attackerElement];
            if (defenderElement === 'Psychic') {
                return true;
            }
            return weaknesses.weakAgainst.includes(defenderElement);
        }


        function getRecovery(baseRecovery) {
            let variance = (Math.random() * 0.8) - 0.4;
            let rareMultiplier = Math.random();
            if (rareMultiplier > 0.95) {
                variance += 0.5; // 5% chance to add more variance
            } else if (rareMultiplier < 0.05) {
                variance -= 0.5; // 5% chance to reduce more
            }
            let newRecovery = baseRecovery * (1 + variance);
            return Math.max(0, Math.round(newRecovery));
        }

        function calculateHitChance(accuracy, evasion) {
            const multiplier = 1.7;
            return (accuracy * multiplier) / (accuracy + evasion);
        }
        function calculateNinjutsuChance(accuracy, evasion) {
            const multiplier = 1.7;
            let newEvasion = evasion / 2.5
            return (accuracy * multiplier) / (accuracy + evasion);
        }

        /// ko -> ken -> ryu ->
        function getRandomItem(list) {
            const randomIndex = Math.floor(Math.random() * list.length);
            return list[randomIndex];
        }


        function determineWinner(player1Choice, player2Choice) {
            player1Choice = player1Choice;
            player2Choice = player2Choice;
            console.log('player1Choice', player1Choice)
            console.log('player2Choice', player2Choice)
            if (
                (player1Choice === 'Ko' && player2Choice === 'Ken') ||
                (player1Choice === 'Ken' && player2Choice === 'Ryu') ||
                (player1Choice === 'Ryu' && player2Choice === 'Ko')
            ) {
                console.log('SAFE')
                return 'SAFE';
            } else {
                console.log('DAMAGE')
                return 'DAMAGE';
            }
        }
        function tryEscape(purity, defense) {
            let baseChance = 35;
            let escapeChance = Math.min(Math.max(baseChance + (defense - purity) * 10, 0), 100); // Calculate escape chance and clamp between 0 and 100

            return Math.random() * 100 <= escapeChance; // Return true if escape successful, false otherwise
        }

        function callDomain(attacker, purity, lethal, duration, defense, cost) {
            let runningDamage = 0;
            let currRedHp = parseInt($('#redHP').text(), 10);
            let currBlueHp = parseInt($('#blueHP').text(), 10);
            let currRedCurse = parseInt($('#redCurrCurse').text(), 10);
            let currBlueCurse = parseInt($('#blueCurrCurse').text(), 10);

            $('#fight_bg').css('background', 'linear-gradient(to bottom, black, black)');

            setTimeout(() => {
                kyo = ['Ko', 'Ken', 'Ryu']

                if (attacker == 'red') {
                    if (currRedCurse < cost) {
                        alert('Not enought curse energy')
                        $('#fight_bg').css('background', 'linear-gradient(to bottom, rgb(159, 159, 159), rgb(159, 159, 159))');
                        return
                    } else {
                        currRedCurse -= cost
                        $('#redCurrCurse').text(currRedCurse)
                    }
                    alert(`Ry≈çiki Tenkai.. defend ${duration} hits!`)
                    for (let i = 1; i <= duration; i++) {
                        if (i % 2 == 1 && i != 1) {
                            let chance = tryEscape(redDomPurity, blueDomPurity)
                            if (chance) {
                                alert('You have created a hole to escape from!')
                                $('#fight_bg').css('background', 'linear-gradient(to bottom, rgb(159, 159, 159), rgb(159, 159, 159))');
                                return
                            } else {
                                alert('The Domain wont break!')
                            }
                        }
                        let attackerChoice = getRandomItem(kyo)
                        let defenderChoice = prompt('Ko -> Ken -> Ryu')
                        let outcome = determineWinner(defenderChoice, attackerChoice)
                        if (outcome != 'SAFE') {
                            runningDamage += 1
                            currBlueHp -= lethal
                            $('#blueHP').text(currBlueHp);
                            chargeCurse('blue', lethal)
                            alert(`Lethal Hit! ${lethal} damage dealt, total: ${lethal * runningDamage}`)
                        } else {
                            alert('blocked üõ°üõ°')
                        }
                    }
                    alert('Domain has concluded..')
                } else {
                    if (currBlueCurse < cost) {
                        alert('Not enough curse energy')
                        $('#fight_bg').css('background', 'linear-gradient(to bottom, rgb(159, 159, 159), rgb(159, 159, 159))');
                        return
                    } else {
                        currBlueCurse -= cost
                        $('#blueCurrCurse').text(currBlueCurse)
                    }
                    alert(`Ry≈çiki Tenkai.. defend ${duration} hits!`)
                    for (let i = 1; i <= duration; i++) {
                        if (i % 2 == 1 && i != 1) {
                            let chance = tryEscape(blueDomPurity, redDomPurity)
                            if (chance) {
                                alert('You have created a hole to escape from!')
                                $('#fight_bg').css('background', 'linear-gradient(to bottom, rgb(159, 159, 159), rgb(159, 159, 159))');
                                return
                            } else {
                                alert('The Domain wont break!')
                            }
                        }
                        let attackerChoice = getRandomItem(kyo)
                        let defenderChoice = prompt('Ko -> Ken -> Ryu')
                        let outcome = determineWinner(defenderChoice, attackerChoice)
                        if (outcome != 'SAFE') {
                            runningDamage += 1
                            currRedHp -= lethal
                            $('#redHP').text(currRedHp);
                            chargeCurse('red', lethal)
                            alert(`Lethal Hit! ${lethal} damage dealt, total: ${lethal * runningDamage}`)
                        } else {
                            alert('blocked üõ°üõ°')
                        }
                    }
                    alert('Domain has concluded..')
                }
                $('#fight_bg').css('background', 'linear-gradient(to bottom, rgb(159, 159, 159), rgb(159, 159, 159))');
            }, 50); // Short timeout (50ms) to allow the browser to repaint
        }


        function updateHealth() {
            let red_corn_hp = prompt('red hp')
            let blue_corn_hp = prompt('blue hp')
            $('#redHP').text(red_corn_hp)
            $('#blueHP').text(blue_corn_hp)
        }
        function gamble(attacker, defender) {
            let currBlueHp = parseInt($('#blueHP').text(), 10);
            let currRedHp = parseInt($('#redHP').text(), 10);
            let attackerLuck = attacker === 'red' ? redLuck : blueLuck;
            let defenderLuck = defender === 'red' ? redLuck : blueLuck;

            let luckDisparity = attackerLuck - defenderLuck;

            // Adjust defender choices based on luck disparity
            let defenderChoices;
            if (luckDisparity >= 7) {
                defenderChoices = 1;
            } else if (luckDisparity === 6) {
                defenderChoices = 2;
            } else if (luckDisparity === 5) {
                defenderChoices = 3;
            } else if (luckDisparity === 4) {
                defenderChoices = 3;
            } else if (luckDisparity == 3) {
                defenderChoices = 4;
            } else if (luckDisparity == 2) {
                defenderChoices = 4;
            } else if (luckDisparity === 1) {
                defenderChoices = 5;
            } else if (luckDisparity === -6) {
                defenderChoices = 9;
            } else if (luckDisparity === -5) {
                defenderChoices = 8;
            } else if (luckDisparity === -4) {
                defenderChoices = 7;
            } else if (luckDisparity == -3) {
                defenderChoices = 7;
            } else if (luckDisparity == -2) {
                defenderChoices = 6;
            } else if (luckDisparity === -1) {
                defenderChoices = 5;
            }

            defenderChoices = Math.min(defenderChoices, 9); // Cap choices between 1-9

            let defenderPick = prompt(`Defender, pick ${defenderChoices} numbers between 1-10 (separate by commas):`);
            let defenderNumbers = defenderPick.split(',').map(num => parseInt(num.trim()));

            let wager = parseInt(prompt("Attacker, name your wager (damage to deal if you win):"));
            let dieRoll = Math.floor(Math.random() * 10) + 1;
            $('#crit').text(`DIE ROLL: ${dieRoll}`)
            console.log('die roll,', dieRoll)

            if (defenderNumbers.includes(dieRoll)) {
                console.log('Defender wins the gamble!');
                let penalty = Math.max(0, Math.floor(wager * (1 + (luckDisparity * 0.2)))); // Ensure penalty is non-negative
                attacker === 'red' ? currRedHp -= penalty : currBlueHp -= penalty;
                $('#damage').hide().text(`Lost gamble! Lost ${penalty} HP ‚ùå`).fadeIn(500);
            } else {
                console.log('Attacker wins the gamble!');
                let bonusDamage = Math.max(0, Math.floor(wager * (luckDisparity > 0 ? 1 : 1.5))); // Ensure bonusDamage is non-negative
                defender === 'red' ? currRedHp -= bonusDamage : currBlueHp -= bonusDamage;
                $('#damage').hide().text(`Won gamble! Dealt ${bonusDamage} damage! üé≤`).fadeIn(500);
            }

            // Ensure HP does not drop below 0
            currRedHp = Math.max(0, currRedHp);
            currBlueHp = Math.max(0, currBlueHp);

            // Update the displayed HP values
            $('#redHP').text(currRedHp);
            $('#blueHP').text(currBlueHp);
        }

        function cursedTool(attacker, curse, amount) {
            if (attacker == 'red') {
                //// LONG IF CHAIN ///
                if (curse == 'Shield') {
                    blueShield -= amount
                }
                if (curse == 'Critical') {
                    blueCrit = (blueCrit -= amount).toFixed(2)
                }
                if (curse == 'Defense') {
                    blueDefense = (blueDefense -= amount)
                }
                if (curse == 'Purity') {
                    blueDomPurity = (blueDomPurity -= amount)
                }
                if (curse == 'Attack') {
                    blueAttack = (blueAttack -= amount)
                }
                if (curse == 'Magic') {
                    blueElmAttack = (blueElmAttack -= amount)
                }
                if (curse == 'Accuracy') {
                    blueAcc -= amount
                }
                if (curse == 'Curse') {
                    blueCurseRec -= amount
                    alert(`Blue curse recovery drops to ${blueCurseRec}`)
                }
                if (curse == 'Recovery') {
                    blueRecovery -= amount
                    alert(`Blue recovery drops to ${blueRecovery}`)
                }
                if (curse == 'Weapon') {
                    blueWeapon -= amount
                }
                if (curse == 'Gen-Power') {
                    blueGenPow -= amount
                }
                if (curse == 'Magic-Def') {
                    blueElmDef -= amount
                }
                if (curse == 'Evasion') {
                    blueEvas -= amount
                }
            }
            if (attacker == 'blue') {
                //// LONG IF CHAIN ///
                if (curse == 'Shield') {
                    redShield -= amount
                }
                if (curse == 'Critical') {
                    redCrit = (redCrit -= amount).toFixed(2)
                }
                if (curse == 'Defense') {
                    redDefense = (redDefense -= amount)
                }
                if (curse == 'Purity') {
                    redDomPurity = (redDomPurity -= amount)
                }
                if (curse == 'Attack') {
                    redAttack = (redAttack -= amount)
                }
                if (curse == 'Magic') {
                    redElmAttack = (redElmAttack -= amount)
                }
                if (curse == 'Accuracy') {
                    redAcc -= amount
                }
                if (curse == 'Curse') {
                    redCurseRec -= amount
                    alert(`Red curse recovery drops to ${redCurseRec}`)
                }
                if (curse == 'Recovery') {
                    redRecovery -= amount
                    alert(`Red recovery drops to ${redRecovery}`)
                }
                if (curse == 'Weapon') {
                    redWeapon -= amount
                }
                if (curse == 'Gen-Power') {
                    redGenPow -= amount
                }
                if (curse == 'Magic-Def') {
                    redElmDef -= amount
                }
                if (curse == 'Evasion') {
                    redEvas -= amount
                }
            }
            // UPDATE U.I
            $('#redHp').text(redHp);
            $('#redAttack').text(redAttack);
            $('#redDefense').text(redDefense);
            $('#redCrit').text(redCrit);
            $('#redStr').text(redStrength);
            $('#redELM').text(redELM);
            $('#redElmAttack').text(redElmAttack);
            $('#redElmDef').text(redElmDef);
            $('#redElmEffc').text(redElmEffc);
            $('#redPot').text(redPotency);
            $('#redGen').text(redGen)
            $('#redGenPow').text(redGenPow)
            $('#redWill').text(redWill)
            $('#redAcc').text(redAcc)
            $('#redEvas').text(redEvas)
            $('#redNinPow').text(redNenNinDmg)
            $('#redUltPow').text(redNinPower)
            $('#redcost1').text(redNenNinCost)
            $('#redcost2').text(redNinCost)
            $('#red_dom_purity').text(redDomPurity)
            $('#red_dom_lethal').text(redDomLethal)
            $('#red_dom_duration').text(redDomDuration)
            $('#red_dom_cost').text(redDomCost)
            $('#redWeapon').text(redWeapon)
            $('#redShield').text(redShield)
            $('#redWeapon').text(redWeapon)

            $('#blueHp').text(blueHp);
            $('#blueAttack').text(blueAttack);
            $('#blueDefense').text(blueDefense);
            $('#blueCrit').text(blueCrit);
            $('#blueStr').text(blueStrength)
            $('#blueAcc').text(blueAcc)
            $('#blueEvas').text(blueEvas)
            $('#bluePot').text(bluePotency);
            $('#blueELM').text(blueELM);
            $('#blueElmAttack').text(blueElmAttack);
            $('#blueElmDef').text(blueElmDef);
            $('#blueElmEffc').text(blueElmEffc);
            $('#blueGen').text(blueGen)
            $('#blueGenPow').text(blueGenPow)
            $('#blueWill').text(blueWill)
            $('#blueNinPow').text(blueNenNinDmg)
            $('#blueUltPow').text(blueNinPower)
            $('#bluecost1').text(blueNenNinCost)
            $('#bluecost2').text(blueNinCost)
            $('#blue_dom_purity').text(blueDomPurity)
            $('#blue_dom_lethal').text(blueDomLethal)
            $('#blue_dom_duration').text(blueDomDuration)
            $('#blue_dom_cost').text(blueDomCost)
            $('#blueShield').text(blueShield)
            $('#blueWeapon').text(blueWeapon)
        }





        function attack(e) {
            e.preventDefault();
            attacker = $('#attacker').val();
            action = $('#actioner').val();
            let currBlueHp = parseInt($('#blueHP').text(), 10);
            let currRedHp = parseInt($('#redHP').text(), 10);
            let currBlueChakra = parseInt($('#blueChakra').text(), 10);
            let currRedChakra = parseInt($('#redChakra').text(), 10);



            console.log('Red Stats:', { redAttack, redDefense, redCrit, redElmAttack, redElmDef, redElmEffc, redHp, redStr, redPot, redELM, currRedChakra });
            console.log('Blue Stats:', { blueAttack, blueDefense, blueCrit, blueElmAttack, blueElmDef, blueElmEffc, blueHp, blueStrength, bluePot, blueELM, currBlueChakra });

            let variance = Math.random() * 0.2 - 0.1;
            let attackerStatusEffects = attacker === 'red' ? redStatus : blueStatus;

            if (attackerStatusEffects.includes('Paralysis')) {
                if (attacker === 'red') {
                    alert('RED IS PARALYZED! Blue goes twice')
                } else {
                    alert('Blue IS PARALYZED! Red goes twice')
                }
            }
            if (attackerStatusEffects.includes('Ultima')) {
                let randomFactor = Math.random();
                let variance = Math.random() * 0.2 - 0.1;
                let ultimaChance;

                if (randomFactor < 0.5) {
                    ultimaChance = 0.5;  // 50% chance to deal half damage
                    alert('Ultima is docile..');
                } else {
                    ultimaChance = 2;  // 50% chance to deal 200% extra damage
                    alert('ULTIMA\'S POWER GROWS');
                }

                if (attacker === 'red') {
                    let ultDamage = Math.round(((blueGenPow * 3.75) * (1 + variance)) * ultimaChance);
                    alert(`Ultima deals ${ultDamage} damage to Red üêà‚Äç‚¨õ`);
                    $('#redHP').text(currRedHp - ultDamage);  // Subtract correct damage
                    chargeCurse('red', ultDamage)
                } else {
                    let ultDamage = Math.round(((redGenPow * 3.75) * (1 + variance)) * ultimaChance);
                    alert(`Ultima deals ${ultDamage} damage to Blue üêà‚Äç‚¨õ`);
                    chargeCurse('blue', ultDamage)
                    $('#blueHP').text(currBlueHp - ultDamage);  // Subtract correct damage
                }
            }


            if (attackerStatusEffects.includes('Flare')) {
                if (attacker === 'red') {
                    let variance = Math.random() * 0.2 - 0.1;
                    let flareDamage = Math.round((blueGenPow * 3.75) * (1 + variance));
                    alert(`Flare! Red takes ${flareDamage} damage ‚ù§Ô∏è‚Äçüî•`)
                    $('#redHP').text(currRedHp - flareDamage);
                    chargeCurse('red', flareDamage)
                } else {
                    let variance = Math.random() * 0.2 - 0.1;
                    let flareDamage = Math.round((redGenPow * 3.75) * (1 + variance));  // Rounding to nearest whole number
                    alert(`Flare! Blue takes ${flareDamage} damage ‚ù§Ô∏è‚Äçüî•`)
                    $('#blueHP').text(currBlueHp - flareDamage);
                    chargeCurse('blue', flareDamage)
                }
            }


            if (action == 'Cursed Tool Attack') {
                let isCritical;
                let criticalMultiplier;
                let hitChance;
                let isHit;

                if (attacker === 'red') {
                    hitChance = calculateHitChance(redAcc, blueEvas);
                    isHit = Math.random() < hitChance;
                    isStun = Math.random() < redStun;
                    if (isStun) {
                        setTimeout(function () {
                            alert('Blue is Stunned!');
                        }, 1500);

                    }

                    ////// CONFUSION CHECK //////////////////////////
                    let isConfused = attackerStatusEffects.includes('Confusion');
                    let hitsSelf = isConfused && Math.random() < 0.5; // 50% chance to hit self

                    if (hitsSelf) {
                        // Attacker is confused and hits themselves
                        console.log('Red is Confused and hits themselves!');

                        // isCritical = Math.random() < redCrit;
                        // criticalMultiplier = isCritical ? redStrength : 1.0;

                        // let selfDamage = ((redAttack * (1 + variance)) - (redDefense / 3)) * criticalMultiplier;
                        // selfDamage = Math.max(1, Math.round(selfDamage));

                        // $('#redHP').text(currRedHp - selfDamage); // Reduce attacker's HP
                        // $('#damage').hide().text(`Hit Self! ${selfDamage} üí•`).fadeIn(500); // Display self-damage
                        // $('#crit').hide().text(isCritical ? 'CRITICAL on SELF! üí•' : '').fadeIn(500);
                        // chargeCurse('red', selfDamage)
                    } else if (isHit) {
                        // Normal attack sequence if not hitting self
                        isCritical = Math.random() < redWeaponCrit;
                        if (isCritical) {
                            console.log('NANAMI CURSED YOU')
                            cursedTool(attacker, redWeaponCurse, redWeaponAmount)
                        }
                        console.log(`${redWeapon} attcking ${blueShield} with a varience of ${variance}`)
                        let damage = ((redWeapon * (1 + variance)) - (blueShield / 4));
                        damage = Math.max(1, Math.round(damage));

                        $('#blueHP').text(currBlueHp - damage); // Reduce defender's HP
                        $('#damage').hide().text(damage).fadeIn(500); // Display damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL! üèπ' : '').fadeIn(500);
                        chargeCurse('blue', damage)
                    } else {
                        $('#damage').hide().text('Missed! ‚ùå').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                        chargeCurse('blue', 175)
                    }
                } else if (attacker === 'blue') {
                    hitChance = calculateHitChance(blueAcc, redEvas);
                    isHit = Math.random() < hitChance;
                    isStun = Math.random() < blueStun;
                    if (isStun) {
                        setTimeout(function () {
                            alert('red is Stunned!');
                        }, 1500);

                    }

                    ////// CONFUSION CHECK //////////////////////////
                    let isConfused = attackerStatusEffects.includes('Confusion');
                    let hitsSelf = isConfused && Math.random() < 0.5; // 50% chance to hit self

                    if (hitsSelf) {
                        // Attacker is confused and hits themselves
                        console.log('Blue is Confused and hits themselves!');

                        // isCritical = Math.random() < blueCrit;
                        // criticalMultiplier = isCritical ? blueStrength : 1.0;

                        // let selfDamage = ((blueAttack * (1 + variance)) - (blueDefense / 3)) * criticalMultiplier;
                        // selfDamage = Math.max(1, Math.round(selfDamage));

                        // $('#blueHP').text(currBlueHp - selfDamage); // Reduce attacker's HP
                        // $('#damage').hide().text(`Hit Self! ${selfDamage} üí•`).fadeIn(500); // Display self-damage
                        // $('#crit').hide().text(isCritical ? 'CRITICAL on SELF! üí•' : '').fadeIn(500);
                        // chargeCurse('blue', selfDamage)
                    } else if (isHit) {
                        // Normal attack sequence if not hitting self
                        isCritical = Math.random() < blueWeaponCrit;
                        // criticalMultiplier = isCritical ? blueStrength : 1.0;
                        if (isCritical) {
                            console.log('NANAMI CURSED YOU')
                            cursedTool(attacker, blueWeaponCurse, blueWeaponAmount)
                        }

                        let damage = ((blueWeapon * (1 + variance)) - (redShield / 4));
                        damage = Math.max(1, Math.round(damage));

                        $('#redHP').text(currRedHp - damage); // Reduce defender's HP
                        $('#damage').hide().text(damage).fadeIn(500); // Display damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL! üèπ' : '').fadeIn(500);
                        chargeCurse('red', damage)
                    } else {
                        // Display a miss message if the hit chance fails
                        $('#damage').hide().text('Missed! ‚ùå').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                        chargeCurse('red', 175)
                    }
                }
            }

            if (action === 'Magic Attack') {
                let isHit;
                let hitChance;

                const redCrit = redPotency;  // Assuming redPot represents crit chance as a decimal
                const blueCrit = bluePotency; // Assuming bluePot represents crit chance as a decimal
                if (attacker === 'red') {
                    hitChance = calculateHitChance(redAcc, blueEvas);
                    isHit = Math.random() < hitChance;
                    isStun = Math.random() < redStun;
                    if (isStun) {
                        setTimeout(function () {
                            alert('Blue is Stunned!');
                        }, 1500);

                    }

                    if (isHit) {
                        let magicEffectiveness = 1.0;
                        let isCritical = Math.random() < redCrit; // Check for critical hit
                        let critMessage = ''; // Initialize crit message

                        // Unique behavior for Sage and Psychic for red attacker
                        if (redELM === 'Sage') {
                            magicEffectiveness *= 1.25; // Increase damage by 50% against all elements
                            critMessage += 'üåó SAGE üåí'; // Add Sage message

                            // Reduce critical hit chance
                            if (Math.random() < (redCrit - 0.2)) { // Reduce critical hit chance by 15%
                                isCritical = false;
                            }
                        } else if (redELM === 'Psychic') {
                            magicEffectiveness = 1; // Normal damage, no enhancements
                            critMessage += 'üîÆ Psychic üîÆ '; // Add Psychic message
                        } else {
                            if (checkWeakness(redELM, blueELM)) {
                                magicEffectiveness = redElmEffc; // Adjust for weakness
                                critMessage += '‚ö°Ô∏è WEAKNESS ‚ö°Ô∏è '; // Add weakness message
                            } else if (checkResistance(redELM, blueELM)) {
                                magicEffectiveness *= 0.75; // Reduce damage by 25% for resistance
                                critMessage += 'üõ°Ô∏è RESISTANT üõ°Ô∏è '; // Add resistance message
                            }
                        }

                        let magicDamage = ((redElmAttack * (1 + variance)) - (blueElmDef / 4)) * magicEffectiveness;

                        // Apply critical hit multiplier
                        if (isCritical) {
                            magicDamage *= 1.375; // Multiply by 1.5 for critical hit
                            critMessage += 'üåü CRITICAL HIT! üåü '; // Add critical hit message
                        }

                        magicDamage = Math.max(1, Math.round(magicDamage));

                        // Update damage message and append critical message
                        $('#damage').hide().text(`${magicDamage} ${critMessage}`).fadeIn(500);
                        $('#blueHP').text(currBlueHp - magicDamage);
                        chargeCurse('blue', magicDamage)
                    } else {
                        $('#damage').hide().text('Missed! ‚ùå').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                        chargeCurse('blue', 175)
                    }

                } else { // For blue attacker
                    hitChance = calculateHitChance(blueAcc, redEvas);
                    isHit = Math.random() < hitChance;
                    isStun = Math.random() < blueStun;
                    if (isStun) {
                        setTimeout(function () {
                            alert('Red is Stunned!');
                        }, 1500);

                    }

                    if (isHit) {
                        let magicEffectiveness = 1.0;
                        let isCritical = Math.random() < blueCrit; // Check for critical hit
                        let critMessage = ''; // Initialize crit message

                        // Unique behavior for Sage and Psychic for blue attacker
                        if (blueELM === 'Sage') {
                            magicEffectiveness *= 1.25; // Increase damage by 50% against all elements
                            critMessage += 'üåò SAGE üåì '; // Add Sage message

                            // Reduce critical hit chance
                            if (Math.random() < (blueCrit - 0.2)) { // Reduce critical hit chance by 15%
                                isCritical = false;
                            }
                        } else if (blueELM === 'Psychic') {
                            magicEffectiveness = 1; // Normal damage, no enhancements
                            critMessage += 'üîÆPsychicüîÆ '; // Add Psychic message
                        } else {
                            // Regular elemental interactions for other elements
                            if (checkWeakness(blueELM, redELM)) {
                                magicEffectiveness = blueElmEffc; // Adjust for weakness
                                critMessage += '‚ö°Ô∏è WEAKNESS ‚ö°Ô∏è '; // Add weakness message
                            } else if (checkResistance(blueELM, redELM)) {
                                magicEffectiveness *= 0.75; // Reduce damage by 25% for resistance
                                critMessage += 'üõ°Ô∏è RESISTANT üõ°Ô∏è '; // Add resistance message
                            }
                        }

                        let magicDamage = ((blueElmAttack * (1 + variance)) - (redElmDef / 4)) * magicEffectiveness;

                        // Apply critical hit multiplier
                        if (isCritical) {
                            magicDamage *= 1.375; // Multiply by 1.5 for critical hit
                            critMessage += 'üåü CRITICAL HIT! üåü '; // Add critical hit message
                        }

                        magicDamage = Math.max(1, Math.round(magicDamage));

                        // Update damage message and append critical message
                        $('#damage').hide().text(`${magicDamage} ${critMessage}`).fadeIn(500);
                        $('#redHP').text(currRedHp - magicDamage);
                        chargeCurse('red', magicDamage)
                    } else {
                        $('#damage').hide().text('Missed! ‚ùå').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                        chargeCurse('red', 175)
                    }
                }

            }
            if (action == 'Domain Expansion') {
                if (attacker == 'red') {
                    let purity = redDomPurity;
                    let lethal = redDomLethal;
                    let duration = redDomDuration;
                    let defense = blueDomPurity
                    let cost = redDomCost
                    callDomain(attacker, purity, lethal, duration, defense, cost)
                } else {
                    let purity = blueDomPurity;
                    let lethal = blueDomLethal;
                    let duration = blueDomDuration;
                    let defense = redDomPurity
                    let cost = blueDomCost
                    callDomain(attacker, purity, lethal, duration, defense, cost)
                }
            }
            if (action == 'Curse Technique') {
                let techName;
                let duration;
                let cost;
                let amount;
                if (attacker == 'red') {
                    techName = $('#redTechName').text()
                    duration = redCurseDuration
                    cost = redCurseCost
                    amount = redCurseAmount
                } else {
                    techName = $('#blueTechName').text()
                    duration = blueCurseDuration
                    cost = blueCurseCost
                    amount = blueCurseAmount
                }
                applyCurseTech(attacker, techName, duration, cost, amount)
            }
            if (action == 'Genjutsu') {

                const multiplier = 1.7; // Genjutsu multiplier
                const scalingFactor = 0.678; // Derived scaling factor from willpower
                let genjutsu;
                let willpower;

                if (attacker == 'red') {
                    genjutsu = redGen;
                    willpower = blueWill;
                } else {
                    genjutsu = blueGen;
                    willpower = redWill;
                }

                let hitChance = (genjutsu * multiplier) / (genjutsu * multiplier + willpower * scalingFactor);
                hitChance = Math.min(Math.max(hitChance, 0), 1);
                const isHit = Math.random() < hitChance;
                console.log('Hit chance', hitChance);


                if (isHit) {
                    alert('"You\'re Already Under My GenJutsu.."');
                    let light = ['Silence', 'Darkness', 'Confusion', 'Paralysis', 'Zombie']
                    let statusEffect = prompt("Choose a status effect to apply: Darkness (6), Silence (6), Zombie (6), Ultima (15), Flare(15), Tsukuyomi (15), Izanagi (15), Kotoamatsukami (18)");
                    // Determine the current chakra variable and decrement it
                    if (attacker === 'red') {
                        // Check if Red has enough chakra for the attack
                        let requiredChakra = 0;

                        if (light.includes(statusEffect)) {
                            requiredChakra = 6;
                        } else if (statusEffect === 'Flare') {
                            requiredChakra = 15;
                        } else if (statusEffect === 'Ultima') {
                            requiredChakra = 15;
                        } else if (statusEffect === 'Tsukuyomi') {
                            requiredChakra = 20;
                        } else if (statusEffect === 'Kotoamatsukami') {
                            requiredChakra = 30;
                        } else if (statusEffect === 'Izanagi') {
                            requiredChakra = 15;
                        }

                        if (currRedChakra < requiredChakra) {
                            alert('Not enough chakra!');
                            return; // Exit the function to prevent the attack
                        }

                        // Deduct chakra if they have enough
                        currRedChakra -= requiredChakra;
                        $('#redChakra').text(currRedChakra); // Update the displayed chakra

                        applyStatusEffect('blue', statusEffect); // Apply effect to the defender

                    } else { // Blue attacker
                        // Check if Blue has enough chakra for the attack
                        let requiredChakra = 0;

                        if (light.includes(statusEffect)) {
                            requiredChakra = 6;
                        } else if (statusEffect === 'Flare') {
                            requiredChakra = 15;
                        } else if (statusEffect === 'Ultima') {
                            requiredChakra = 15;
                        } else if (statusEffect === 'Tsukuyomi') {
                            requiredChakra = 20;
                        } else if (statusEffect === 'Kotoamatsukami') {
                            requiredChakra = 30;
                        } else if (statusEffect === 'Izanagi') {
                            requiredChakra = 15;
                        }

                        if (currBlueChakra < requiredChakra) {
                            alert('Not enough chakra!');
                            return; // Exit the function to prevent the attack
                        }

                        // Deduct chakra if they have enough
                        currBlueChakra -= requiredChakra;
                        $('#blueChakra').text(currBlueChakra); // Update the displayed chakra

                        applyStatusEffect('red', statusEffect); // Apply effect to the defender
                    }

                } else {
                    alert('GenJutsu of that level doesn\'t work on me');
                }
                endRound()
                return
            }

            if (action == 'Update HP') {
                updateHealth()
            }
            if (action == 'Devil Contract') {
                if (attacker == 'red') {
                    gamble('red', 'blue')
                } else {
                    gamble('blue', 'red')
                }
            }
            if (action == 'Hatsu Buff') {
                if (attacker == 'red') {
                    console.log('a buff has been used!')
                    buff(redBuff, 'und', 0, 0, 'MISC', 'no', 'no')
                } else {
                    console.log('a buff has been used!')
                    buff(blueBuff, 'und', 0, 0, 'MISC', 'no', 'no')
                }

            }
            if (action == 'Zetsu Buff') {
                if (attacker == 'red') {
                    console.log('a buff has been used!')
                    buff(redBuff2, 'und', 0, 0, 'MISC', 'no', 'no')
                } else {
                    console.log('a buff has been used!')
                    buff(blueBuff2, 'und', 0, 0, 'MISC', 'no', 'no')
                }
            }
            if (action == 'Ultimate Ninjutsu') {
                let redJutsu = redNenNin.split(' ')[0];
                let redUltJutsu = redNinjutsu.split(' ')[0];
                let blueJutsu = blueNenNin.split(' ')[0];
                let blueUltJutsu = blueNinjutsu.split(' ')[0]
                if (attacker == 'red') {
                    if (currRedChakra < redNinCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }

                    let hitted = calculateNinjutsuChance(redAcc, blueEvas)
                    if (hitted) {
                        currRedChakra -= redNinCost
                        $('#redChakra').text(currRedChakra)
                        $('#blueHP').text(currBlueHp - redNinPower);
                        $('#crit').text(redChakra)
                        $('#damage').text(`üåãüåã ${redNinPower}  üåãüåã`)
                        chargeCurse('blue', redNinPower)
                        buff(100, 'red', redNinAmount, redUltAmount, redUltJutsu, redUltEnhance, true)
                        endRound()
                        return
                    } else {
                        $('#damage').text('Red Misses ‚ùå')
                        chargeCurse('blue', blueNinPower)
                        return
                    }

                } else {
                    if (currBlueChakra < blueNinCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }
                    let hitted = calculateNinjutsuChance(blueAcc, redEvas)
                    if (hitted) {
                        currBlueChakra -= blueNinCost;
                        $('#blueChakra').text(currBlueChakra)
                        $('#redHP').text(currRedHp - blueNinPower);
                        $('#damage').text(`üåãüåã  ${blueNinPower}  üåãüåã`)
                        chargeCurse('red', blueNinPower)
                        //buff(buff, attacker, cost, ultCost, jutsu, enhance, ultimate)
                        buff(100, 'blue', blueNinAmount, blueUltAmount, blueUltJutsu, blueUltEnhance, true)
                        endRound()
                        return
                    } else {
                        $('#damage').text('Blue Misses ‚ùå')
                        chargeCurse('red', blueNinPower)
                        return
                    }

                }
            }
            if (action == 'Ninjutsu') {
                let redJutsu = redNenNin.split(' ')[0];
                let redUltJutsu = redNinjutsu.split(' ')[0];
                let blueJutsu = blueNenNin.split(' ')[0];
                let blueUltJutsu = blueNinjutsu.split(' ')[0]
                if (attacker == 'red') {
                    if (currRedChakra < redNenNinCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }
                    let isHitt = calculateNinjutsuChance(redAcc, blueEvas)
                    if (isHitt) {
                        currRedChakra -= redNenNinCost
                        $('#redChakra').text(currRedChakra)
                        $('#blueHP').text(currBlueHp - redNenNinDmg);
                        $('#crit').text(redChakra)
                        $('#damage').text(`‚ú´ ${redNenNinDmg}  ‚ú´`)
                        chargeCurse('blue', redNenNinDmg)
                        buff(100, 'red', redNinAmount, redUltAmount, redJutsu, redNinEnhance, false)
                        endRound()
                        return
                    } else {
                        $('#damage').text('Red Misses ‚ùå')
                        chargeCurse('blue', redNinPower)
                        return
                    }

                } else {
                    if (currBlueChakra < blueNenNinCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }
                    let isHitt = calculateNinjutsuChance(blueAcc, redEvas)
                    if (isHitt) {
                        currBlueChakra -= blueNenNinCost;
                        $('#blueChakra').text(currBlueChakra)
                        $('#redHP').text(currRedHp - blueNenNinDmg);
                        $('#damage').text(`‚ú´  ${blueNenNinDmg}  ‚ú´`)
                        chargeCurse('red', blueNenNinDmg)
                        buff(100, 'blue', blueNinAmount, blueUltAmount, blueJutsu, blueNinEnhance, false)
                        endRound()
                        return
                    } else {
                        $('#damage').text('Blue Misses ‚ùå')
                        chargeCurse('red', blueNinPower)
                        return
                    }

                }
            }

            if (action == 'Boost') {
                if (attacker == 'red') {
                    let boosted = redRecovery * 2;
                    let newChakra = getRecovery(boosted)
                    currRedChakra += newChakra
                    $('#damage').text(`Gained ${newChakra} chakra`)
                    $('#redChakra').text(currRedChakra);
                } else {
                    let boosted = blueRecovery * 2;
                    let newChakra = getRecovery(boosted)
                    currBlueChakra += newChakra
                    $('#damage').text(`Gained ${newChakra} chakra`)
                    $('#blueChakra').text(currBlueChakra);
                }
            }
            if (action == 'Drain') {
                if (attacker == 'red') {
                    let empty = getRecovery(redDrain)
                    currBlueChakra -= empty;
                    $('#damage').text(`${empty} Depleted`)
                    $('#blueChakra').text(currBlueChakra)
                } else {
                    let empty = getRecovery(blueDrain)
                    currRedChakra -= empty;
                    $('#damage').text(`${empty} Depleted`)
                    $('#redChakra').text(currRedChakra)
                }
            }

            if (action === 'Attack') {
                let isCritical;
                let criticalMultiplier;
                let hitChance;
                let isHit;

                if (attacker === 'red') {
                    hitChance = calculateHitChance(redAcc, blueEvas);
                    isHit = Math.random() < hitChance;
                    isStun = Math.random() < redStun;
                    if (isStun) {
                        setTimeout(function () {
                            alert('Blue is Stunned!');
                        }, 1500);

                    }

                    ////// CONFUSION CHECK //////////////////////////
                    let isConfused = attackerStatusEffects.includes('Confusion');
                    let hitsSelf = isConfused && Math.random() < 0.5; // 50% chance to hit self

                    if (hitsSelf) {
                        // Attacker is confused and hits themselves
                        console.log('Red is Confused and hits themselves!');

                        isCritical = Math.random() < redCrit;
                        criticalMultiplier = isCritical ? redStrength : 1.0;

                        let selfDamage = ((redAttack * (1 + variance)) - (redDefense / 4)) * criticalMultiplier;
                        selfDamage = Math.max(1, Math.round(selfDamage));

                        $('#redHP').text(currRedHp - selfDamage); // Reduce attacker's HP
                        $('#damage').hide().text(`Hit Self! ${selfDamage} üí•`).fadeIn(500); // Display self-damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL on SELF! üí•' : '').fadeIn(500);
                        chargeCurse('red', selfDamage)
                    } else if (isHit) {
                        // Normal attack sequence if not hitting self
                        isCritical = Math.random() < redCrit;
                        criticalMultiplier = isCritical ? redStrength : 1.0;

                        let damage = ((redAttack * (1 + variance)) - (blueDefense / 4)) * criticalMultiplier;
                        damage = Math.max(1, Math.round(damage));

                        $('#blueHP').text(currBlueHp - damage); // Reduce defender's HP
                        $('#damage').hide().text(damage).fadeIn(500); // Display damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL! üí•' : '').fadeIn(500);
                        chargeCurse('blue', damage)
                    } else {
                        $('#damage').hide().text('Missed! ‚ùå').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                        chargeCurse('blue', 175)
                    }
                } else if (attacker === 'blue') {
                    hitChance = calculateHitChance(blueAcc, redEvas);
                    isHit = Math.random() < hitChance;
                    isStun = Math.random() < blueStun;
                    if (isStun) {
                        setTimeout(function () {
                            alert('Red is Stunned!');
                        }, 1500);

                    }

                    ////// CONFUSION CHECK //////////////////////////
                    let isConfused = attackerStatusEffects.includes('Confusion');
                    let hitsSelf = isConfused && Math.random() < 0.5; // 50% chance to hit self

                    if (hitsSelf) {
                        // Attacker is confused and hits themselves
                        console.log('Blue is Confused and hits themselves!');

                        isCritical = Math.random() < blueCrit;
                        criticalMultiplier = isCritical ? blueStrength : 1.0;

                        let selfDamage = ((blueAttack * (1 + variance)) - (blueDefense / 4)) * criticalMultiplier;
                        selfDamage = Math.max(1, Math.round(selfDamage));

                        $('#blueHP').text(currBlueHp - selfDamage); // Reduce attacker's HP
                        $('#damage').hide().text(`Hit Self! ${selfDamage} üí•`).fadeIn(500); // Display self-damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL on SELF! üí•' : '').fadeIn(500);
                        chargeCurse('blue', selfDamage)
                    } else if (isHit) {
                        // Normal attack sequence if not hitting self
                        isCritical = Math.random() < blueCrit;
                        criticalMultiplier = isCritical ? blueStrength : 1.0;

                        let damage = ((blueAttack * (1 + variance)) - (redDefense / 4)) * criticalMultiplier;
                        damage = Math.max(1, Math.round(damage));

                        $('#redHP').text(currRedHp - damage); // Reduce defender's HP
                        $('#damage').hide().text(damage).fadeIn(500); // Display damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL! üí•' : '').fadeIn(500);
                        chargeCurse('red', damage)
                    } else {
                        // Display a miss message if the hit chance fails
                        $('#damage').hide().text('Missed! ‚ùå').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                        chargeCurse('red', 175)
                    }
                }
            }


            if (attacker == 'red' && action != 'Drain' && action != 'Boost') {
                currRedChakra += getRecovery(redRecovery);
                $('#redChakra').text(currRedChakra);
                console.log('hisoka should get sime')
            } else if (attacker == 'blue' && action != 'Drain' && action != 'Boost') {
                console.log('kuroro should get sime', blueRecovery)
                let testRecovery = getRecovery(blueRecovery)
                console.log('here is func return', testRecovery)
                currBlueChakra += testRecovery;
                $('#blueChakra').text(currBlueChakra);
                console.log('here is current chakre', currBlueChakra)
            }
            endRound()
        }





        $('#attack-form').submit(attack)

        function action(e) {
            e.preventDefault();
            $('#attack-form').show()
            let val_1 = $('#red_corner_search').val();
            let val_2 = $('#blue_corner_search').val();
            $('#redStatus').hide()
            $('#blueStatus').hide()

            let redHtml = '';
            let blueHtml = '';

            for (let player of databaseArr) {
                if (val_1 === player.name) {
                    redHtml = `
            <div class='fight_time_card'>
                <div class='fight_corner_header'>
                    <h4 class='hi2'>${player.name}</h4>
                    <img class='elem_img_corner' red_elm_imgg src='${player.elm}'>
                </div>
                <img id='fight_corner_img' src='${player.image}'>
                <p id='redStatus'>${redStatus}</p>
                <p id='redCurseUi'></p>
                <h4 contenteditable="true">üñ§ <span id='redHP'>${player.hp}</span></h4>
                <p>${player.nen_type}</p>
             <div class="fight_corner_stats">
    <div>
        <p>‚öîÔ∏è</p>
        <span id="redAttack">${player.attack}</span>
    </div>
    <div>
        <p>üõ°Ô∏è</p>
        <span id="redDefense">${player.defense}</span>
    </div>
    <div>
        <p>üí•</p>
        <span id="redCrit">${player.critical}</span>
    </div>
     <div>
        <p>ü™¶</p>
        <span id="redStr">${player.strength}</span>
    </div>
    <div>
        <p>ü™Ñ</p>
        <span id="redElmAttack">${player.elm_attack}</span>
    </div>
    <div>
        <p>‚ô†Ô∏è</p>
        <span id="redElmDef">${player.elm_defense}</span>
    </div>
   <div>
        <p>üß™</p>
        <span id="redPot">${player.potency}</span>
    </div>
        <div>
        <p>‚õà</p>
        <span id="redElmEffc">${player.elm_efficiency}</span>
    </div>
     <div>
        <p>üèπ</p>
        <span id="redWeapon">${player.weapon}</span>
    </div>
    <div>
        <p>êÇ´</p>
        <span id="redShield">${player.shield}</span>
    </div>
    <div class='nen_numbers'>
        <p class='redWeaponCurse' >${player.weaponCurse}</p>
        <p id="redWeaponCrit">${player.curse_crit}</p>
    </div>
    <div class='nen_numbers'>
        <p id="redDrain">‚ô∫ ${player.drain}</p>
        <p id="redNegative">ü™¨ ${player.negative_energy}</p>
    </div>
    <div>
        <p>üçÄ</p>
        <span id="redLuck">${player.luck}</span>
    </div>

    <div>
        <p>üéØ</p>
        <span id="redAcc">${player.accuracy}</span>
    </div>
    <div>
        <p>üïä</p>
        <span id="redEvas">${player.evasion}</span>
    </div>
    <div>
        <p><img id = 'devi' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/95c36513-b099-481c-8c69-95184b1b961f/d9vyb32-2451d476-beb8-4925-bd1c-58a83b96cb23.png/v1/fit/w_828,h_1072/796_liquidic_by_tigers_stock_d9vyb32-414w-2x.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTMyNiIsInBhdGgiOiJcL2ZcLzk1YzM2NTEzLWIwOTktNDgxYy04YzY5LTk1MTg0YjFiOTYxZlwvZDl2eWIzMi0yNDUxZDQ3Ni1iZWI4LTQ5MjUtYmQxYy01OGE4M2I5NmNiMjMucG5nIiwid2lkdGgiOiI8PTEwMjQifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.qixgqabB2ZXK93dFP-t3CVRNTz4AQhWvXTTUNR52h7E'></p>
        <span id="redChakra">${player.chakra}</span>
    </div>
     <div>
        <p>ü§ûüèº</p>
        <span id='red_dom_purity'>${player.dom_purity}</span>
    </div>
    <div>
        <p>ü©∏</p>
        <span id='red_dom_lethal'>${player.dom_lethal}</span>
    </div>
    <div>
        <p>üåò</p>
        <span><span id='red_dom_duration'>${player.dom_duration}</span> / <span id='red_dom_cost'>${player.dom_cost}</span></span>
    </div>
    <div>
        <p><img id= 'finger' src='https://fbi.cults3d.com/uploaders/14057732/illustration-file/bd0e604a-19b3-468d-838a-7c52773a543d/render7.png'></p>
        <span  id='redCurrCurse'>${player.cursed_energy}</span>
    </div>
    <div>
        <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/3319dd28-31c1-4c70-9762-7302cd5f3a39/d5oj8ng-3aec6bd0-7cbc-4427-9aa3-0959534477f2.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzMzMTlkZDI4LTMxYzEtNGM3MC05NzYyLTczMDJjZDVmM2EzOVwvZDVvajhuZy0zYWVjNmJkMC03Y2JjLTQ0MjctOWFhMy0wOTU5NTM0NDc3ZjIucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0._xkR2jk4ujU4UUBoX4rpsltZual6BjSQHwM5W8cqpyU'></p>
        <span id="redGen">${player.genjutsu}</span>
    </div>
     <div>
        <p><img id='devi' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/c359dd66-9e20-4344-8d5d-0e2ef292d317/d4t4t8l-9a2dbc38-cdee-48a1-90c8-e844f7a23a8f.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcL2MzNTlkZDY2LTllMjAtNDM0NC04ZDVkLTBlMmVmMjkyZDMxN1wvZDR0NHQ4bC05YTJkYmMzOC1jZGVlLTQ4YTEtOTBjOC1lODQ0ZjdhMjNhOGYucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.0DqohEo1tRU2GNzploqd60S_ACwBeEcWF7fmT-HpwKc'></p>
        <span id="redGenPow">${player.gen_power}</span>
    </div>
    <div>
          <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/cbf38665-92e9-4ecb-8712-324e6b7af2f9/dfymy05-ee66f427-b0c8-476f-ab04-f42e3e93aa42.png/v1/fill/w_894,h_894/hymn_of_light_ritual_circle_by_rogermorhan_dfymy05-pre.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MjQwMCIsInBhdGgiOiJcL2ZcL2NiZjM4NjY1LTkyZTktNGVjYi04NzEyLTMyNGU2YjdhZjJmOVwvZGZ5bXkwNS1lZTY2ZjQyNy1iMGM4LTQ3NmYtYWIwNC1mNDJlM2U5M2FhNDIucG5nIiwid2lkdGgiOiI8PTI0MDAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.Bh4EFTpGjHUASHdab8wPDpGy59wA5suWbNIC--cZtgg'></p>
        <span id="redWill">${player.willpower}</span>
    </div>
    <div class='nen_numbers'>
        <p id="redNinPow">${player.ninJutsu2Dmg}</p>
        <p id="redUltPow">${player.ninjutsu_pow}</p>
    </div>

</div>

                <p class='words'>${player.ninjutsu2} ‚úÆ <span id='redcost1'>${player.ninJutsu2cost}</span></p>
                <p class='words'>${player.ninjutsu} ‚úÆ <span id='redcost2'>${player.nin_cost}</span></p>
                <hr>
                  <p class='words'><span id = 'redTechName'>${player.cursed_tech}</span> ‚ú´ <span id='redCurseTech'>${player.curse_cost}</span></p>
                <hr>
                <p class='words'> ${player.buff} ‚úÆ <span id='buff_red'>${player.buff_acc}%</span></p>
                <p class='words'>${player.buff2} ‚úÆ <span id='buff_red'>${player.buff2_acc}%</span></p>
            </div>
            `;
                    redAttack = player.attack;
                    redDefense = player.defense;
                    redCrit = player.critical;
                    redElmAttack = player.elm_attack;
                    redElmDef = player.elm_defense;
                    redElmEffc = player.elm_efficiency;
                    redHp = player.hp;
                    redStrength = player.strength;
                    redPotency = player.potency;
                    redBuff = player.buff_acc;
                    redBuff2 = player.buff2_acc;
                    redELM = player.element
                    redRecovery = player.chakra_rec
                    redCost = player.cost
                    redChakraPower = player.chakra_pow
                    redNinjutsu = player.ninjutsu;
                    redNinCost = player.nin_cost;
                    redNinPower = player.ninjutsu_pow
                    redNenNin = player.ninjutsu2
                    redNenNinCost = player.ninJutsu2cost
                    redNenNinDmg = player.ninJutsu2Dmg
                    redAcc = player.accuracy
                    redEvas = player.evasion
                    redLuck = player.luck
                    redGen = player.genjutsu
                    redGenPow = player.gen_power
                    redWill = player.willpower
                    redCurseEnergy = player.cursed_energy
                    redCurseRec = player.cursed_recovery
                    redCurseTech = player.cursed_tech
                    redCurseCost = player.curse_cost
                    redCurseDuration = player.curse_duration
                    redCurseAmount = player.curse_amount
                    redDomPurity = player.dom_purity
                    redDomLethal = player.dom_lethal
                    redDomDuration = player.dom_duration
                    redDomCost = player.dom_cost
                    redDomName = player.dom_name
                    originalRedRecovery = player.chakra_rec
                    originalRedAttack = player.attack
                    originalRedMagic = player.elm_attack
                    redNinAmount = player.nin2amount
                    redUltAmount = player.ninamount
                    redNinEnhance = player.ninEnhance
                    redUltEnhance = player.ultEnhance
                    redWeapon = player.weapon
                    redShield = player.shield
                    redWeaponCrit = player.curse_crit
                    redWeaponCurse = player.weaponCurse
                    redWeaponAmount = player.weapon_amount
                    redStun = player.stun
                    redDrain = player.drain
                    redNegative = player.negative_energy
                } else if (val_2 === player.name) {
                    blueHtml = `
            <div class='fight_time_card'>
                <div class='fight_corner_header'>
                    <h4 class='hi1'>${player.name}</h4>
                    <img class='elem_img_corner' id='blue_elm_imgg' src='${player.elm}'>
                </div>
                <img id='fight_corner_img' src='${player.image}'>
                <p id='blueStatus'>${blueStatus}</p>
                <p id='blueCurseUi'></p>
                <h4 contenteditable="true">üñ§ <span id='blueHP'>${player.hp}</span></h4>
                <p>${player.nen_type}</p>
               <div class='fight_corner_stats'>
    <div>
        <p>‚öîÔ∏è</p>
        <span id="blueAttack">${player.attack}</span>
    </div>
    <div>
        <p>üõ°</p>
        <span id="blueDefense">${player.defense}</span>
    </div>
    <div>
        <p>üí•</p>
        <span id="blueCrit">${player.critical}</span>
    </div>
    <div>
        <p>ü™¶</p>
        <span id="blueStr">${player.strength}</span>
    </div>
    <div>
        <p>ü™Ñ</p>
        <span id="blueElmAttack">${player.elm_attack}</span>
    </div>
    <div>
        <p>‚ô†Ô∏è</p>
        <span id="blueElmDef">${player.elm_defense}</span>
    </div>
    <div>
        <p>üß™</p>
        <span id="bluePot">${player.potency}</span>
    </div>
    <div>
        <p>‚õà</p>
        <span id="blueElmEffc">${player.elm_efficiency}</span>
    </div>
     <div>
        <p>üèπ</p>
        <span id="blueWeapon">${player.weapon}</span>
    </div>
    <div>
        <p>êÇ´</p>
        <span id="blueShield">${player.shield}</span>
    </div>
    <div class='nen_numbers'>
        <p class='blueWeaponCurse'>${player.weaponCurse}</p>
        <p id="blueWeaponCrit">${player.curse_crit}</p>
    </div>
    <div class='nen_numbers'>
        <p id="blueDrain">‚ô∫ ${player.drain}</p>
        <p id="blueNegative">ü™¨ ${player.negative_energy}</p>
    </div>
     <div>
        <p>üçÄ</p>
        <span id="blueLuck">${player.luck}</span>
    </div>
    <div>
        <p>üéØ</p>
        <span id="blueAcc">${player.accuracy}</span>
    </div>
    <div>
        <p>üïä</p>
        <span id="blueEvas">${player.evasion}</span>
    </div>
    <div>
        <p><img id = 'devi' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/95c36513-b099-481c-8c69-95184b1b961f/d9vyb32-2451d476-beb8-4925-bd1c-58a83b96cb23.png/v1/fit/w_828,h_1072/796_liquidic_by_tigers_stock_d9vyb32-414w-2x.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTMyNiIsInBhdGgiOiJcL2ZcLzk1YzM2NTEzLWIwOTktNDgxYy04YzY5LTk1MTg0YjFiOTYxZlwvZDl2eWIzMi0yNDUxZDQ3Ni1iZWI4LTQ5MjUtYmQxYy01OGE4M2I5NmNiMjMucG5nIiwid2lkdGgiOiI8PTEwMjQifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.qixgqabB2ZXK93dFP-t3CVRNTz4AQhWvXTTUNR52h7E'></p>
        <span id="blueChakra">${player.chakra}</span>
    </div>

    <div>
        <p>ü§ûüèº</p>
        <span id='blue_dom_purity'>${player.dom_purity}</span>
    </div>
    <div>
        <p>ü©∏</p>
        <span id='blue_dom_lethal'>${player.dom_lethal}</span>
    </div>
    <div>
        <p>üåí</p>
        <span><span id='blue_dom_duration'>${player.dom_duration}</span> / <span id='blue_dom_cost'>${player.dom_cost}</span></span>
    </div>
    <div>
        <p><img id= 'finger' src='https://fbi.cults3d.com/uploaders/14057732/illustration-file/bd0e604a-19b3-468d-838a-7c52773a543d/render7.png'></p>
        <span id='blueCurrCurse'>${player.cursed_energy}</span>
    </div>


    <div>
        <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/3319dd28-31c1-4c70-9762-7302cd5f3a39/d5oj8ng-3aec6bd0-7cbc-4427-9aa3-0959534477f2.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzMzMTlkZDI4LTMxYzEtNGM3MC05NzYyLTczMDJjZDVmM2EzOVwvZDVvajhuZy0zYWVjNmJkMC03Y2JjLTQ0MjctOWFhMy0wOTU5NTM0NDc3ZjIucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0._xkR2jk4ujU4UUBoX4rpsltZual6BjSQHwM5W8cqpyU'></p>
        <span id="blueGen">${player.genjutsu}</span>
    </div>
    <div>
        <p><img id='devi' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/c359dd66-9e20-4344-8d5d-0e2ef292d317/d4t4t8l-9a2dbc38-cdee-48a1-90c8-e844f7a23a8f.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcL2MzNTlkZDY2LTllMjAtNDM0NC04ZDVkLTBlMmVmMjkyZDMxN1wvZDR0NHQ4bC05YTJkYmMzOC1jZGVlLTQ4YTEtOTBjOC1lODQ0ZjdhMjNhOGYucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.0DqohEo1tRU2GNzploqd60S_ACwBeEcWF7fmT-HpwKc'></p>
        <span id="blueGenPow">${player.gen_power}</span>
    </div>
    <div>
        <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/cbf38665-92e9-4ecb-8712-324e6b7af2f9/dfymy05-ee66f427-b0c8-476f-ab04-f42e3e93aa42.png/v1/fill/w_894,h_894/hymn_of_light_ritual_circle_by_rogermorhan_dfymy05-pre.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MjQwMCIsInBhdGgiOiJcL2ZcL2NiZjM4NjY1LTkyZTktNGVjYi04NzEyLTMyNGU2YjdhZjJmOVwvZGZ5bXkwNS1lZTY2ZjQyNy1iMGM4LTQ3NmYtYWIwNC1mNDJlM2U5M2FhNDIucG5nIiwid2lkdGgiOiI8PTI0MDAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.Bh4EFTpGjHUASHdab8wPDpGy59wA5suWbNIC--cZtgg'></p>
        <span id="blueWill">${player.willpower}</span>
    </div>
    <div class='nen_numbers'>
        <p id="blueNinPow">${player.ninJutsu2Dmg}</p>
        <p id="blueUltPow">${player.ninjutsu_pow}</p>
    </div>

</div>



               <p class='words'>${player.ninjutsu2} ‚úÆ <span id='bluecost1'>${player.ninJutsu2cost}</span></p>
               <p class='words'>${player.ninjutsu} ‚úÆ <span id='bluecost2'>${player.nin_cost}</span></p>
               <hr>
                 <p class='words'><span id='blueTechName'>${player.cursed_tech}</span> ‚ú´ <span id='blueCurseTech'>${player.curse_cost}</span></p>
                  <hr>
               <p class='words'>${player.buff} ‚úÆ <span id='buff_red'>${player.buff_acc}%</span></p>
               <p class='words'>${player.buff2} ‚úÆ <span id='buff_red'>${player.buff2_acc}%</span></p>
            </div>
            `;
                    blueAttack = player.attack;
                    blueDefense = player.defense;
                    blueCrit = player.critical;
                    blueElmAttack = player.elm_attack;
                    blueElmDef = player.elm_defense;
                    blueElmEffc = player.elm_efficiency;
                    blueHp = player.hp;
                    blueStrength = player.strength;
                    bluePotency = player.potency;
                    blueBuff = player.buff_acc
                    blueBuff2 = player.buff2_acc
                    blueELM = player.element
                    blueRecovery = player.chakra_rec
                    blueCost = player.cost
                    blueChakraPower = player.chakra_pow
                    blueNinjutsu = player.ninjutsu;
                    blueNinCost = player.nin_cost;
                    blueNinPower = player.ninjutsu_pow
                    blueAcc = player.accuracy
                    blueEvas = player.evasion
                    blueLuck = player.luck
                    blueGen = player.genjutsu
                    blueGenPow = player.gen_power
                    blueWill = player.willpower
                    blueCurseEnergy = player.cursed_energy
                    blueCurseRec = player.cursed_recovery
                    blueCurseTech = player.cursed_tech
                    blueCurseCost = player.curse_cost
                    blueCurseDuration = player.curse_duration
                    blueCurseAmount = player.curse_amount
                    blueDomPurity = player.dom_purity
                    blueDomLethal = player.dom_lethal
                    blueDomCost = player.dom_cost
                    blueDomDuration = player.dom_duration
                    blueDomName = player.dom_name
                    originalBlueRecovery = player.chakra_rec
                    originalBlueAttack = player.attack
                    originalBlueMagic = player.elm_attack
                    blueNenNin = player.ninjutsu2
                    blueNenNinCost = player.ninJutsu2cost
                    blueNenNinDmg = player.ninJutsu2Dmg
                    blueNinAmount = player.nin2amount
                    blueUltAmount = player.ninamount
                    blueNinEnhance = player.ninEnhance
                    blueUltEnhance = player.ultEnhance
                    blueWeapon = player.weapon
                    blueShield = player.shield
                    blueWeaponCrit = player.curse_crit
                    blueWeaponCurse = player.weaponCurse
                    blueWeaponAmount = player.weapon_amount
                    blueStun = player.stun
                    blueDrain = player.drain
                    blueNegative = player.negative_energy
                }
            }

            $('#red_corner').html(redHtml);
            $('#blue_corner').html(blueHtml);
            $('#fight_form_fight').hide()
        }



        function filterSuggestions(inputId, suggestionsId, team) {
            $(inputId).on('input', function () {
                let filter = $(this).val().toLowerCase();
                let suggestions = $(suggestionsId);
                suggestions.empty(); // Clear previous suggestions

                if (filter) {
                    for (let player of team) {
                        if (player.name.toLowerCase().includes(filter)) {
                            suggestions.append(`<div>${player.name}</div>`);
                        }
                    }
                }

                // Handle clicking on a suggestion
                $(suggestionsId).on('click', 'div', function () {
                    $(inputId).val($(this).text()); // Set input to selected suggestion
                    suggestions.empty(); // Clear suggestions
                });
            });
        }

        // Apply filtering for red and blue corners
        filterSuggestions('#red_corner_search', '#red_corner_suggestions', databaseArr);
        filterSuggestions('#blue_corner_search', '#blue_corner_suggestions', databaseArr);


        $('#fight_form_fight').submit(action)
    </script>

</html>
