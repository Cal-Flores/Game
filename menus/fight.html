<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>FIGHT</title>
        <script src="../database/players.js"></script>
        <script src="../database/database.js"></script>
        <link rel="stylesheet" href="menu.css">
        <link rel="stylesheet" href="../Teams/teams.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    </head>

    <body id="fight_bg">
        <form id="fight_form_fight" class="fight-form">
            <label for="red_corner_search">Red Corner</label>
            <input type="text" id="red_corner_search" placeholder="Type player's name" class="fight-input">
            <div id="red_corner_suggestions" class="suggestions"></div>

            <label for="blue_corner_search">Blue Corner</label>
            <input type="text" id="blue_corner_search" placeholder="Type player's name" class="fight-input">
            <div id="blue_corner_suggestions" class="suggestions"></div>

            <input type="submit" class="fight-submit" value="Fight">
        </form>


        <div class="corner_container">
            <div id="red_corner"></div>
            <div>
                <div>
                    <p id="crit"></p>
                    <p id="damage"></p>
                </div>
                <form id="attack-form">
                    <label>Turn</label>
                    <select id="attacker">
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                    </select>
                    <label>Choose Move</label>
                    <select id="actioner">
                        <option>Attack</option>
                        <option>Elemental Attack</option>
                        <option>Ninjutsu</option>
                        <option>Ultimate Ninjutsu</option>
                        <option>Special Attack</option>
                        <option>Nen Attack</option>
                        <option>Genjutsu</option>
                        <option>Devil Contract</option>
                        <option>Boost</option>
                        <option>Drain</option>
                        <option>Update HP</option>
                    </select>
                    <input type="submit">
                </form>
            </div>
            <div id="blue_corner"></div>
        </div>
    </body>

    <script>
        $('#attack-form').hide()
        let databaseArr = database;

        let blueAttack
        let blueDefense
        let blueCrit
        let blueElmAttack
        let blueElmDef
        let blueElmEffc
        let blueHp
        let blueStrength
        let bluePotency
        let blueBuff
        let blueBuff2
        let blueELM
        let blueChakra
        let blueRecovery //
        let blueCost
        let blueChakraPower
        let blueNinjutsu
        let blueNinCost
        let blueNinPower
        let blueAcc
        let blueEvas
        let blueLuck
        let blueGen
        let blueWill;
        let blueStatus = []

        let redAttack
        let redDefense
        let redCrit
        let redElmAttack
        let redElmDef
        let redElmEffc
        let redHp
        let redStrength
        let redPotency
        let redBuff
        let redBuff2
        let redELM
        let redChakra
        let redRecovery
        let redCost
        let redChakraPower
        let redNinjutsu
        let redNinCost
        let redNinPower
        let redAcc
        let redEvas
        let redLuck
        let redGen;
        let redWill;
        let redStatus = []


        function buff(buff) {
            buff = buff / 100;
            isBuff = Math.random() < buff;
            if (isBuff) {
                alert('success');
                let stat_max = prompt('STAT? redAttack, redDefense, redCrit, redElmAttack, redElmDef, redElmEffc, redHp, redStr, redPot, redELM, redRecovery,redCost,redNinCost,redChakraPower, redEvas, redLuck blueAttack, blueDefense, blueCrit, blueElmAttack, blueElmDef, blueElmEffc, blueHp, blueStr, bluePot, blueELM, blueRecovery, blueCost, blueNinCost, blueChakraPower,blueEvas, blueLuck');
                console.log('stat_max is ', stat_max);
                let stat_type = prompt('Increase or Decrease');
                let stat_number = parseFloat(prompt('By how much'));

                switch (stat_max) {
                    case 'redAttack':
                        if (stat_type == 'Increase') {
                            redAttack = Math.floor(redAttack * (1 + stat_number));
                        } else {
                            redAttack = Math.floor(redAttack * (1 - stat_number));
                        }
                        break;
                    case 'redDefense':
                        if (stat_type == 'Increase') {
                            redDefense = Math.floor(redDefense * (1 + stat_number));
                        } else {
                            redDefense = Math.floor(redDefense * (1 - stat_number));
                        }
                        break;
                    case 'redCrit':
                        if (stat_type == 'Increase') {
                            redCrit = Math.floor(redCrit * (1 + stat_number));
                        } else {
                            redCrit = Math.floor(redCrit * (1 - stat_number));
                        }
                        break;
                    case 'redElmAttack':
                        if (stat_type == 'Increase') {
                            redElmAttack = Math.floor(redElmAttack * (1 + stat_number));
                        } else {
                            redElmAttack = Math.floor(redElmAttack * (1 - stat_number));
                        }
                        break;
                    case 'redElmDef':
                        if (stat_type == 'Increase') {
                            redElmDef = Math.floor(redElmDef * (1 + stat_number));
                        } else {
                            redElmDef = Math.floor(redElmDef * (1 - stat_number));
                        }
                        break;
                    case 'redElmEffc':
                        if (stat_type == 'Increase') {
                            redElmEffc = Math.floor(redElmEffc * (1 + stat_number));
                        } else {
                            redElmEffc = Math.floor(redElmEffc * (1 - stat_number));
                        }
                        break;
                    case 'redHp':
                        if (stat_type == 'Increase') {
                            redHp = Math.max(0, Math.floor(redHp * (1 + stat_number))); // Ensuring no negative values
                        } else {
                            redHp = Math.max(0, Math.floor(redHp * (1 - stat_number)));
                        }
                        break;
                    case 'redStr':
                        if (stat_type == 'Increase') {
                            redStr = Math.floor(redStr * (1 + stat_number));
                        } else {
                            redStr = Math.floor(redStr * (1 - stat_number));
                        }
                        break;
                    case 'redPot':
                        if (stat_type == 'Increase') {
                            redPot = Math.floor(redPot * (1 + stat_number));
                        } else {
                            redPot = Math.floor(redPot * (1 - stat_number));
                        }
                        break;
                    case 'redELM':
                        if (stat_type == 'Increase') {
                            redELM = Math.floor(redELM * (1 + stat_number));
                        } else {
                            redELM = Math.floor(redELM * (1 - stat_number));
                        }
                        break;
                    case 'redRecovery':
                        if (stat_type == 'Increase') {
                            redRecovery = Math.floor(redRecovery + stat_number); // Corrected to use redRecovery
                        } else {
                            redRecovery = Math.floor(redRecovery - stat_number);
                        }
                        break;
                    case 'redCost':
                        if (stat_type == 'Increase') {
                            redCost = Math.floor(redCost * (1 + stat_number));
                        } else {
                            redCost = Math.floor(redCost * (1 - stat_number));
                        }
                        break;
                    case 'redNinCost':
                        if (stat_type == 'Increase') {
                            redNinCost = Math.floor(redNinCost * (1 + stat_number));
                        } else {
                            redNinCost = Math.floor(redNinCost * (1 - stat_number));
                        }
                        break;
                    case 'redAcc':
                        if (stat_type == 'Increase') {
                            redAcc = Math.floor(redAcc * (1 + stat_number));
                        } else {
                            redAcc = Math.floor(redAcc * (1 - stat_number));
                        }
                        break;
                    case 'redEvas':
                        if (stat_type == 'Increase') {
                            redEvas = Math.floor(redEvas * (1 + stat_number));
                        } else {
                            redEvas = Math.floor(redEvas * (1 - stat_number));
                        }
                        break;
                    case 'redLuck':
                        if (stat_type == 'Increase') {
                            redLuck = Math.floor(redLuck * (1 + stat_number));
                        } else {
                            redLuck = Math.floor(redLuck * (1 - stat_number));
                        }
                        break;
                    case 'redChakraPower':
                        if (stat_type == 'Increase') {
                            redChakraPower = Math.floor(redChakraPower * (1 + stat_number));
                        } else {
                            redChakraPower = Math.floor(redChakraPower * (1 - stat_number));
                        }
                        break;
                    case 'blueAttack':
                        if (stat_type == 'Increase') {
                            blueAttack = Math.floor(blueAttack * (1 + stat_number));
                        } else {
                            blueAttack = Math.floor(blueAttack * (1 - stat_number));
                        }
                        break;
                    case 'blueDefense':
                        if (stat_type == 'Increase') {
                            blueDefense = Math.floor(blueDefense * (1 + stat_number));
                        } else {
                            blueDefense = Math.floor(blueDefense * (1 - stat_number));
                        }
                        break;
                    case 'blueCrit':
                        if (stat_type == 'Increase') {
                            blueCrit = Math.floor(blueCrit * (1 + stat_number));
                        } else {
                            blueCrit = Math.floor(blueCrit * (1 - stat_number));
                        }
                        break;
                    case 'blueElmAttack':
                        if (stat_type == 'Increase') {
                            blueElmAttack = Math.floor(blueElmAttack * (1 + stat_number));
                        } else {
                            blueElmAttack = Math.floor(blueElmAttack * (1 - stat_number));
                        }
                        break;
                    case 'blueElmDef':
                        if (stat_type == 'Increase') {
                            blueElmDef = Math.floor(blueElmDef * (1 + stat_number));
                        } else {
                            blueElmDef = Math.floor(blueElmDef * (1 - stat_number));
                        }
                        break;
                    case 'blueElmEffc':
                        if (stat_type == 'Increase') {
                            blueElmEffc = Math.floor(blueElmEffc * (1 + stat_number));
                        } else {
                            blueElmEffc = Math.floor(blueElmEffc * (1 - stat_number));
                        }
                        break;
                    case 'blueHp':
                        if (stat_type == 'Increase') {
                            blueHp = Math.max(0, Math.floor(blueHp * (1 + stat_number))); // Ensuring no negative values
                        } else {
                            blueHp = Math.max(0, Math.floor(blueHp * (1 - stat_number)));
                        }
                        break;
                    case 'blueStr':
                        if (stat_type == 'Increase') {
                            blueStr = Math.floor(blueStr * (1 + stat_number));
                        } else {
                            blueStr = Math.floor(blueStr * (1 - stat_number));
                        }
                        break;
                    case 'bluePot':
                        if (stat_type == 'Increase') {
                            bluePot = Math.floor(bluePot * (1 + stat_number));
                        } else {
                            bluePot = Math.floor(bluePot * (1 - stat_number));
                        }
                        break;
                    case 'blueELM':
                        if (stat_type == 'Increase') {
                            blueELM = Math.floor(blueELM * (1 + stat_number));
                        } else {
                            blueELM = Math.floor(blueELM * (1 - stat_number));
                        }
                        break;
                    case 'blueRecovery':
                        if (stat_type == 'Increase') {
                            blueRecovery = Math.floor(blueRecovery + stat_number); // Corrected to use blueRecovery
                        } else {
                            blueRecovery = Math.floor(blueRecovery - stat_number);
                        }
                        break;
                    case 'blueCost':
                        if (stat_type == 'Increase') {
                            blueCost = Math.floor(blueCost * (1 + stat_number));
                        } else {
                            blueCost = Math.floor(blueCost * (1 - stat_number));
                        }
                        break;
                    case 'blueNinCost':
                        if (stat_type == 'Increase') {
                            blueNinCost = Math.floor(blueNinCost * (1 + stat_number));
                        } else {
                            blueNinCost = Math.floor(blueNinCost * (1 - stat_number));
                        }
                        break;
                    case 'blueAcc':
                        if (stat_type == 'Increase') {
                            blueAcc = Math.floor(blueAcc * (1 + stat_number));
                        } else {
                            blueAcc = Math.floor(blueAcc * (1 - stat_number));
                        }
                        break;
                    case 'blueEvas':
                        if (stat_type == 'Increase') {
                            blueEvas = Math.floor(blueEvas * (1 + stat_number));
                        } else {
                            blueEvas = Math.floor(blueEvas * (1 - stat_number));
                        }
                        break;
                    case 'blueChakraPower':
                        if (stat_type == 'Increase') {
                            blueChakraPower = Math.floor(blueChakraPower * (1 + stat_number));
                        } else {
                            blueChakraPower = Math.floor(blueChakraPower * (1 - stat_number));
                        }
                        break;
                    case 'blueLuck':
                        if (stat_type == 'Increase') {
                            blueLuck = Math.floor(blueLuck * (1 + stat_number));
                        } else {
                            blueLuck = Math.floor(blueLuck * (1 - stat_number));
                        }
                        break;
                    default:
                        alert('Invalid stat');
                        break;
                }




                // Update the stats on the page if necessary
                $('#redAttack').text(redAttack);
                $('#redDefense').text(redDefense);
                $('#redCrit').text(redCrit);
                $('#redElmAttack').text(redElmAttack);
                $('#redElmDef').text(redElmDef);
                $('#redElmEffc').text(redElmEffc);
                $('#redHp').text(redHp);
                $('#redStr').text(redStr);
                $('#redPot').text(redPot);
                $('#redELM').text(redELM);
                $('#blueAttack').text(blueAttack);
                $('#blueDefense').text(blueDefense);
                $('#blueCrit').text(blueCrit);
                $('#blueElmAttack').text(blueElmAttack);
                $('#blueElmDef').text(blueElmDef);
                $('#blueElmEffc').text(blueElmEffc);
                $('#blueHp').text(blueHp);
                $('#blueStr').text(blueStr);
                $('#bluePot').text(bluePot);
                $('#blueELM').text(blueELM);

            } else {
                $('#damage').text('Fail');
            }
        }



        function triggerTsukuyomiExplosion(defender) {
            // Define the damage for Tsukuyomi explosion
            if (defender === 'red') {
                let power = parseInt($('#blueChakra').text(), 10)
                let explosionDamage = power * 10;
                let currRedHp = parseInt($('#redHP').text(), 10);
                $('#redHP').text(currRedHp - explosionDamage);
                alert('Tsukuyomi explodes! Red takes ' + explosionDamage + ' damage.');
            } else if (defender === 'blue') {
                let power = parseInt($('#redChakra').text(), 10)
                let explosionDamage = power * 10;
                let currBlueHp = parseInt($('#blueHP').text(), 10);
                $('#blueHP').text(currBlueHp - explosionDamage);
                alert('Tsukuyomi explodes! Blue takes ' + explosionDamage + ' damage.');
            }
            clearStatusEffect(defender, 'Tsukuyomi'); // Clear the Tsukuyomi status effect after it explodes
        }

        let roundCounters = { red: {}, blue: {} }; // Track round counters
        let tsukuyomiCounters = { red: 0, blue: 0 }; // Track Tsukuyomi specific counters

        function genjutsuAttack(genjutsu, willpower, color) {
            if (genjutsu > willpower) {
                let statusEffect = prompt("Choose a status effect to apply: Darkness (5), Silence (5), Confusion (5), Paralysis (5), Zombie (5), Ultima (25), Flare(25), Tsukuyomi, Kotoamatsukami");
                applyStatusEffect(color, statusEffect); // Apply effect to the defender
            }
        }

        function applyStatusEffect(defender, statusEffect) {
            let duration = 4; // Default duration for all effects
            if (statusEffect == 'Ultima' || statusEffect == 'Flare') {
                duration = 2
            } else if (statusEffect == 'Tsukuyomi') {
                duration = 7; // Tsukuyomi takes 6 rounds to trigger
                tsukuyomiCounters[defender] = 0; // Start Tsukuyomi counter at 0
            }

            if (defender === 'red') {
                redStatus.push(statusEffect);
                roundCounters.red[statusEffect] = duration; // Set duration for this effect
                $('#redStatus').show().text(redStatus.join(', '));
            } else if (defender === 'blue') {
                blueStatus.push(statusEffect);
                roundCounters.blue[statusEffect] = duration; // Set duration for this effect
                $('#blueStatus').show().text(blueStatus.join(', '));
            }
        }
        function endRound() {
            // Update round counters for each player's status effects
            for (let status of Object.keys(roundCounters.red)) {
                roundCounters.red[status]--;
                if (roundCounters.red[status] === 0) {
                    clearStatusEffect('red', status);
                }
            }

            for (let status of Object.keys(roundCounters.blue)) {
                roundCounters.blue[status]--;
                if (roundCounters.blue[status] === 0) {
                    clearStatusEffect('blue', status);
                }
            }
            if (redStatus.includes('Tsukuyomi')) {
                tsukuyomiCounters.red++;
                console.log('counter', tsukuyomiCounters.red)
                if (tsukuyomiCounters.red >= 6) {
                    triggerTsukuyomiExplosion('red');
                }
            }
            if (blueStatus.includes('Tsukuyomi')) {
                tsukuyomiCounters.blue++;
                console.log('counter', tsukuyomiCounters.blue)
                if (tsukuyomiCounters.blue >= 6) {
                    triggerTsukuyomiExplosion('blue');
                }
            }

        }

        function clearStatusEffect(defender, statusEffect) {
            if (defender === 'red') {
                redStatus = redStatus.filter(status => status !== statusEffect); // Remove effect
                delete roundCounters.red[statusEffect]; // Remove duration
                $('#redStatus').show().text(redStatus.join(', ')); // Update UI
                resetStats('red', statusEffect); // Reset stats when status effect ends

            } else if (defender === 'blue') {
                blueStatus = blueStatus.filter(status => status !== statusEffect); // Remove effect
                delete roundCounters.blue[statusEffect]; // Remove duration
                $('#blueStatus').show().text(blueStatus.join(', ')); // Update UI
                resetStats('blue', statusEffect); // Reset stats when status effect ends
            }
        }

        let originalBlueRecovery = blueRecovery
        let originalRedRecovery = redRecovery
        let originalBlueAttack = blueAttack
        let originalRedAttack = redAttack
        let originalRedMagic = redElmAttack
        let originalBlueMagic = blueElmAttack

        function resetStats(defender, statusEffect) {

            switch (statusEffect) {
                case 'Zombie':
                    if (defender === 'red') {
                        redRecovery = originalRedRecovery; // Reset to original value
                    } else {
                        blueRecovery = originalBlueRecovery; // Reset for blue
                    }
                    break;
                case 'Darkness':
                    if (defender === 'red') {
                        redAttack = originalRedAttack; // Reset to original value
                    } else {
                        blueAttack = originalBlueAttack; // Reset for blue
                    }
                    break;
                case 'Silence':
                    if (defender === 'red') {
                        redElmAttack = originalRedMagic; // Reset to original value
                    } else {
                        blueElmAttack = originalBlueMagic;// Reset for blue
                    }
                    break;
                // Handle other status effects here
            }
        }
        const elementalWeaknesses = {
            Water: { strongAgainst: ['Fire', 'Earth'], weakAgainst: ['Lightning', 'Grass'] },
            Fire: { strongAgainst: ['Wind', 'Grass'], weakAgainst: ['Water', 'Earth'] },
            Wind: { strongAgainst: ['Water', 'Lightning'], weakAgainst: ['Earth', 'Fire'] },
            Lightning: { strongAgainst: ['Water', 'Grass'], weakAgainst: ['Earth', 'Fighter'] },
            Earth: { strongAgainst: ['Fire', 'Lightning'], weakAgainst: ['Water', 'Grass'] },
            Grass: { strongAgainst: ['Water', 'Earth'], weakAgainst: ['Fire', 'Lightning'] },
            Fighter: { strongAgainst: ['Dark', 'Grass'], weakAgainst: ['Lightning', 'Water'] },
            Dark: { strongAgainst: ['Grass', 'Water'], weakAgainst: ['Fire', 'Fighter'] },
            Sage: { strongAgainst: [], weakAgainst: [] },
            Psychic: { strongAgainst: [], weakAgainst: [] },
        };

        function checkWeakness(attackerElement, defenderElement) {
            const weaknesses = elementalWeaknesses[attackerElement];
            return weaknesses.strongAgainst.includes(defenderElement);
        }

        function checkResistance(attackerElement, defenderElement) {
            const weaknesses = elementalWeaknesses[attackerElement];
            return weaknesses.weakAgainst.includes(defenderElement);
        }

        function calculateHitChance(accuracy, evasion) {
            const multiplier = 1.8;
            return (accuracy * multiplier) / (accuracy + evasion);
        }

        function getRecovery(baseRecovery) {
            let variance = (Math.random() * 0.8) - 0.4;
            let rareMultiplier = Math.random();
            if (rareMultiplier > 0.95) {
                variance += 0.5; // 5% chance to add more variance
            } else if (rareMultiplier < 0.05) {
                variance -= 0.5; // 5% chance to reduce more
            }
            let newRecovery = baseRecovery * (1 + variance);
            return Math.max(0, Math.round(newRecovery));
        }

        function calculateHitChance(accuracy, evasion) {
            const multiplier = 1.7;
            return (accuracy * multiplier) / (accuracy + evasion);
        }

        function updateHealth() {
            let red_corn_hp = prompt('red hp')
            let blue_corn_hp = prompt('blue hp')
            $('#redHP').text(red_corn_hp)
            $('#blueHP').text(blue_corn_hp)
        }
        function gamble(attacker, defender) {
            let currBlueHp = parseInt($('#blueHP').text(), 10);
            let currRedHp = parseInt($('#redHP').text(), 10);
            let attackerLuck = attacker === 'red' ? redLuck : blueLuck;
            let defenderLuck = defender === 'red' ? redLuck : blueLuck;

            let luckDisparity = attackerLuck - defenderLuck;

            // Adjust defender choices based on luck disparity
            let defenderChoices;
            if (luckDisparity >= 7) {
                defenderChoices = 1;
            } else if (luckDisparity === 6) {
                defenderChoices = 2;
            } else if (luckDisparity === 5) {
                defenderChoices = 3;
            } else if (luckDisparity === 4) {
                defenderChoices = 3;
            } else if (luckDisparity == 3) {
                defenderChoices = 4;
            } else if (luckDisparity == 2) {
                defenderChoices = 4;
            } else if (luckDisparity === 1) {
                defenderChoices = 5;
            } else if (luckDisparity === -6) {
                defenderChoices = 9;
            } else if (luckDisparity === -5) {
                defenderChoices = 8;
            } else if (luckDisparity === -4) {
                defenderChoices = 7;
            } else if (luckDisparity == -3) {
                defenderChoices = 7;
            } else if (luckDisparity == -2) {
                defenderChoices = 6;
            } else if (luckDisparity === -1) {
                defenderChoices = 5;
            }

            defenderChoices = Math.min(defenderChoices, 9); // Cap choices between 1-9

            let defenderPick = prompt(`Defender, pick ${defenderChoices} numbers between 1-10 (separate by commas):`);
            let defenderNumbers = defenderPick.split(',').map(num => parseInt(num.trim()));

            let wager = parseInt(prompt("Attacker, name your wager (damage to deal if you win):"));
            let dieRoll = Math.floor(Math.random() * 10) + 1;

            if (defenderNumbers.includes(dieRoll)) {
                console.log('Defender wins the gamble!');
                let penalty = Math.max(0, Math.floor(wager * (1 + (luckDisparity * 0.2)))); // Ensure penalty is non-negative
                attacker === 'red' ? currRedHp -= penalty : currBlueHp -= penalty;
                $('#damage').hide().text(`Lost gamble! Lost ${penalty} HP ❌`).fadeIn(500);
            } else {
                console.log('Attacker wins the gamble!');
                let bonusDamage = Math.max(0, Math.floor(wager * (luckDisparity > 0 ? 1 : 1.5))); // Ensure bonusDamage is non-negative
                defender === 'red' ? currRedHp -= bonusDamage : currBlueHp -= bonusDamage;
                $('#damage').hide().text(`Won gamble! Dealt ${bonusDamage} damage! 🎲`).fadeIn(500);
            }

            // Ensure HP does not drop below 0
            currRedHp = Math.max(0, currRedHp);
            currBlueHp = Math.max(0, currBlueHp);

            // Update the displayed HP values
            $('#redHP').text(currRedHp);
            $('#blueHP').text(currBlueHp);
        }





        function attack(e) {
            e.preventDefault();
            attacker = $('#attacker').val();
            action = $('#actioner').val();
            let currBlueHp = parseInt($('#blueHP').text(), 10);
            let currRedHp = parseInt($('#redHP').text(), 10);
            let currBlueChakra = parseInt($('#blueChakra').text(), 10);
            let currRedChakra = parseInt($('#redChakra').text(), 10);



            console.log('Red Stats:', { redAttack, redDefense, redCrit, redElmAttack, redElmDef, redElmEffc, redHp, redStr, redPot, redELM, currRedChakra });
            console.log('Blue Stats:', { blueAttack, blueDefense, blueCrit, blueElmAttack, blueElmDef, blueElmEffc, blueHp, blueStr, bluePot, blueELM, currBlueChakra });

            let variance = Math.random() * 0.2 - 0.1;
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! GENJUTSU CHECKPOINT !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!//
            let attackerStatusEffects = attacker === 'red' ? redStatus : blueStatus;
            console.log('DITO', attackerStatusEffects)
            if (attackerStatusEffects.includes('Zombie')) {
                if (attacker === 'red') {
                    redRecovery = 0;
                } else {
                    blueRecovery = 0
                }
            }
            if (attackerStatusEffects.includes('Darkness')) {
                if (attacker === 'red') {
                    redAttack = 0;
                } else {
                    blueAttack = 0
                }
            }
            if (attackerStatusEffects.includes('Silence')) {
                if (attacker === 'red') {
                    redElmAttack = 0;
                } else {
                    blueElmAttack = 0
                }
            }
            if (attackerStatusEffects.includes('Paralysis')) {
                if (attacker === 'red') {
                    alert('RED IS PARALYZED! Blue goes twice')
                } else {
                    alert('Blue IS PARALYZED! Red goes twice')
                }
            }
            if (attackerStatusEffects.includes('Ultima')) {
                if (attacker === 'red') {
                    let genDamage = 1000;
                    // $('#damage').hide().text(`ULTIMA ${genDamage}❤️‍🔥`).fadeIn(500);
                    $('#redHP').text(currRedHp - genDamage);
                } else {
                    let genDamage = 1000;
                    $('#damage').hide().text(`ULTIMA ${genDamage}❤️‍🔥`).fadeIn(500);
                    $('#blueHP').text(currBlueHp - genDamage);
                }
            }
            if (attackerStatusEffects.includes('Flare')) {
                if (attacker === 'red') {
                    let flareDamage = 500;
                    // $('#damage').hide().text(`ULTIMA ${genDamage}❤️‍🔥`).fadeIn(500);
                    $('#redHP').text(currRedHp - flareDamage);
                } else {
                    let flareDamage = 500;
                    // $('#damage').hide().text(`ULTIMA ${genDamage}❤️‍🔥`).fadeIn(500);
                    $('#blueHP').text(currBlueHp - flareDamage);
                }
            }




            if (action === 'Elemental Attack') {
                let isHit;
                let hitChance;

                const redCrit = redPot;  // Assuming redPot represents crit chance as a decimal
                const blueCrit = bluePot; // Assuming bluePot represents crit chance as a decimal

                if (attacker === 'red') {
                    hitChance = calculateHitChance(redAcc, blueEvas);
                    isHit = Math.random() < hitChance;

                    if (isHit) {
                        let magicEffectiveness = 1.0;
                        let isCritical = Math.random() < redCrit; // Check for critical hit
                        let critMessage = ''; // Initialize crit message

                        if (checkWeakness(redELM, blueELM)) {
                            magicEffectiveness = redElmEffc; // Adjust for weakness
                            critMessage += '⚡️ WEAKNESS ⚡️ '; // Add weakness message
                        } else if (checkResistance(redELM, blueELM)) {
                            magicEffectiveness *= 0.75; // Reduce damage by 25% for resistance
                            critMessage += '🛡️ RESISTANT 🛡️ '; // Add resistance message
                        }

                        let magicDamage = ((redElmAttack * (1 + variance)) - (blueElmDef / 3)) * magicEffectiveness;

                        // Apply critical hit multiplier
                        if (isCritical) {
                            magicDamage *= 1.5; // Multiply by 1.5 for critical hit
                            critMessage += '🌟 CRITICAL HIT! 🌟 '; // Add critical hit message
                        }

                        magicDamage = Math.max(1, Math.round(magicDamage));

                        // Update damage message and append critical message
                        $('#damage').hide().text(`${magicDamage} ${critMessage}`).fadeIn(500);
                        $('#blueHP').text(currBlueHp - magicDamage);
                    } else {
                        $('#damage').hide().text('Missed! ❌').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                    }

                } else { // For blue attacker
                    hitChance = calculateHitChance(blueAcc, redEvas);
                    isHit = Math.random() < hitChance;

                    if (isHit) {
                        let magicEffectiveness = 1.0;
                        let isCritical = Math.random() < blueCrit; // Check for critical hit
                        let critMessage = ''; // Initialize crit message

                        if (checkWeakness(blueELM, redELM)) {
                            magicEffectiveness = blueElmEffc; // Adjust for weakness
                            critMessage += '⚡️ WEAKNESS ⚡️ '; // Add weakness message
                        } else if (checkResistance(blueELM, redELM)) {
                            magicEffectiveness *= 0.75; // Reduce damage by 25% for resistance
                            critMessage += '🛡️ RESISTANT 🛡️ '; // Add resistance message
                        }

                        let magicDamage = ((blueElmAttack * (1 + variance)) - (redElmDef / 3)) * magicEffectiveness;

                        // Apply critical hit multiplier
                        if (isCritical) {
                            magicDamage *= 1.5; // Multiply by 1.5 for critical hit
                            critMessage += '🌟 CRITICAL HIT! 🌟 '; // Add critical hit message
                        }

                        magicDamage = Math.max(1, Math.round(magicDamage));

                        // Update damage message and append critical message
                        $('#damage').hide().text(`${magicDamage} ${critMessage}`).fadeIn(500);
                        $('#redHP').text(currRedHp - magicDamage);
                    } else {
                        $('#damage').hide().text('Missed! ❌').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                    }
                }
            }
            if (action == 'Genjutsu') {
                if (attacker == 'red') {
                    genjutsuAttack(redGen, blueWill, 'blue')
                } else {
                    genjutsuAttack(blueGen, redWill, 'red')
                }
            }

            if (action == 'Update HP') {
                updateHealth()
            }
            if (action == 'Devil Contract') {
                if (attacker == 'red') {
                    gamble('red', 'blue')
                } else {
                    gamble('blue', 'red')
                }
            }
            if (action == 'Special Attack') {
                if (attacker == 'red') {
                    console.log('a buff has been used!')
                    buff(redBuff)
                } else {
                    console.log('a buff has been used!')
                    buff(blueBuff)
                }

            }
            if (action == 'Nen Attack') {
                if (attacker == 'red') {
                    console.log('a buff has been used!')
                    buff(redBuff2)
                } else {
                    console.log('a buff has been used!')
                    buff(blueBuff2)
                }
            }
            if (action == 'Ninjutsu') {
                if (attacker == 'red') {
                    if (currRedChakra < redCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }
                    currRedChakra -= redCost
                    $('#redChakra').text(currRedChakra)
                    $('#blueHP').text(currBlueHp - redChakraPower);
                    $('#damage').text(`🥷  ${redChakraPower}  🥷`)
                    return
                } else {
                    if (currBlueChakra < blueCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }
                    currBlueChakra -= blueCost
                    $('#blueChakra').text(currBlueChakra)
                    $('#redHP').text(currRedHp - blueChakraPower);
                    $('#damage').text(`🥷  ${blueChakraPower}  🥷`)
                    return
                }
            }
            if (action == 'Ultimate Ninjutsu') {
                if (attacker == 'red') {
                    if (currRedChakra < redNinCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }
                    currRedChakra -= redNinCost
                    $('#redChakra').text(currRedChakra)
                    $('#blueHP').text(currBlueHp - redNinPower);
                    $('#crit').text(redChakra)
                    $('#damage').text(`🌋🌋 ${redNinPower}  🌋🌋`)
                    buff(100)
                    return
                } else {
                    if (currBlueChakra < blueNinCost) {
                        alert('NOT ENOUGH CHAKRA LOSE TURN')
                        return
                    }
                    currBlueChakra -= blueNinCost;
                    $('#blueChakra').text(currBlueChakra)
                    $('#redHP').text(currRedHp - blueNinPower);
                    $('#damage').text(`🌋🌋  ${blueNinPower}  🌋🌋`)
                    buff(100)
                    return
                }
            }
            if (action == 'Boost') {
                if (attacker == 'red') {
                    let boosted = redRecovery * 2.5;
                    let newChakra = getRecovery(boosted)
                    currRedChakra += newChakra
                    $('#damage').text(`Gained ${newChakra} chakra`)
                    $('#redChakra').text(currRedChakra);
                } else {
                    let boosted = blueRecovery * 2.5;
                    let newChakra = getRecovery(boosted)
                    currBlueChakra += newChakra
                    $('#damage').text(`Gained ${newChakra} chakra`)
                    $('#blueChakra').text(currBlueChakra);
                }
            }
            if (action == 'Drain') {
                if (attacker == 'red') {
                    let drain = redRecovery * 2;
                    let empty = getRecovery(drain)
                    currBlueChakra -= empty;
                    $('#damage').text(`${empty} Depleted`)
                    $('#blueChakra').text(currBlueChakra)
                } else {
                    let drain = blueRecovery * 2.5;
                    let empty = getRecovery(drain)
                    currRedChakra -= empty;
                    $('#damage').text(`${empty} Depleted`)
                    $('#redChakra').text(currRedChakra)
                }
            }

            if (action === 'Attack') {
                let isCritical;
                let criticalMultiplier;
                let hitChance;
                let isHit;

                if (attacker === 'red') {
                    hitChance = calculateHitChance(redAcc, blueEvas);
                    isHit = Math.random() < hitChance;

                    ////// CONFUSION CHECK //////////////////////////
                    let isConfused = attackerStatusEffects.includes('Confusion');
                    let hitsSelf = isConfused && Math.random() < 0.5; // 50% chance to hit self

                    if (hitsSelf) {
                        // Attacker is confused and hits themselves
                        console.log('Red is Confused and hits themselves!');

                        isCritical = Math.random() < redCrit;
                        criticalMultiplier = isCritical ? redStr : 1.0;

                        let selfDamage = ((redAttack * (1 + variance)) - (redDefense / 2.5)) * criticalMultiplier;
                        selfDamage = Math.max(1, Math.round(selfDamage));

                        $('#redHP').text(currRedHp - selfDamage); // Reduce attacker's HP
                        $('#damage').hide().text(`Hit Self! ${selfDamage} 💥`).fadeIn(500); // Display self-damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL on SELF! 💥' : '').fadeIn(500);
                    } else if (isHit) {
                        // Normal attack sequence if not hitting self
                        isCritical = Math.random() < redCrit;
                        criticalMultiplier = isCritical ? redStr : 1.0;

                        let damage = ((redAttack * (1 + variance)) - (blueDefense / 2.5)) * criticalMultiplier;
                        damage = Math.max(1, Math.round(damage));

                        $('#blueHP').text(currBlueHp - damage); // Reduce defender's HP
                        $('#damage').hide().text(damage).fadeIn(500); // Display damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL! 💥' : '').fadeIn(500);
                    } else {
                        $('#damage').hide().text('Missed! ❌').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                    }
                } else if (attacker === 'blue') {
                    hitChance = calculateHitChance(blueAcc, redEvas);
                    isHit = Math.random() < hitChance;

                    ////// CONFUSION CHECK //////////////////////////
                    let isConfused = attackerStatusEffects.includes('Confusion');
                    let hitsSelf = isConfused && Math.random() < 0.5; // 50% chance to hit self

                    if (hitsSelf) {
                        // Attacker is confused and hits themselves
                        console.log('Blue is Confused and hits themselves!');

                        isCritical = Math.random() < blueCrit;
                        criticalMultiplier = isCritical ? blueStr : 1.0;

                        let selfDamage = ((blueAttack * (1 + variance)) - (blueDefense / 2.5)) * criticalMultiplier;
                        selfDamage = Math.max(1, Math.round(selfDamage));

                        $('#blueHP').text(currBlueHp - selfDamage); // Reduce attacker's HP
                        $('#damage').hide().text(`Hit Self! ${selfDamage} 💥`).fadeIn(500); // Display self-damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL on SELF! 💥' : '').fadeIn(500);
                    } else if (isHit) {
                        // Normal attack sequence if not hitting self
                        isCritical = Math.random() < blueCrit;
                        criticalMultiplier = isCritical ? blueStr : 1.0;

                        let damage = ((blueAttack * (1 + variance)) - (redDefense / 2.5)) * criticalMultiplier;
                        damage = Math.max(1, Math.round(damage));

                        $('#redHP').text(currRedHp - damage); // Reduce defender's HP
                        $('#damage').hide().text(damage).fadeIn(500); // Display damage
                        $('#crit').hide().text(isCritical ? 'CRITICAL! 💥' : '').fadeIn(500);
                    } else {
                        // Display a miss message if the hit chance fails
                        $('#damage').hide().text('Missed! ❌').fadeIn(500);
                        $('#crit').hide().text('').fadeIn(500);
                    }
                }
            }


            if (attacker == 'red' && action != 'Drain' && action != 'Boost') {
                currRedChakra += getRecovery(redRecovery);
                $('#redChakra').text(currRedChakra);
                console.log('hisoka should get sime')
            } else if (attacker == 'blue' && action != 'Drain' && action != 'Boost') {
                console.log('kuroro should get sime', blueRecovery)
                let testRecovery = getRecovery(blueRecovery)
                console.log('here is func return', testRecovery)
                currBlueChakra += testRecovery;
                $('#blueChakra').text(currBlueChakra);
                console.log('here is current chakre', currBlueChakra)
            }
            endRound()
        }





        $('#attack-form').submit(attack)

        function action(e) {
            e.preventDefault();
            $('#attack-form').show()
            let val_1 = $('#red_corner_search').val();
            let val_2 = $('#blue_corner_search').val();
            $('#redStatus').hide()
            $('#blueStatus').hide()

            let redHtml = '';
            let blueHtml = '';

            for (let player of databaseArr) {
                if (val_1 === player.name) {
                    redHtml = `
            <div class='fight_time_card'>
                <div class='fight_corner_header'>
                    <h4 class='hi'>${player.name}</h4>
                    <img class='elem_img_corner' src='${player.elm}'>
                </div>
                <img id='fight_corner_img' src='${player.image}'>
                <p id='redStatus'>${redStatus}</p>
                <h4 contenteditable="true">🖤 <span id='redHP'>${player.hp}</span></h4>
                <p>${player.nen_type}</p>
             <div class="fight_corner_stats">
    <div>
        <p>⚔️</p>
        <span id="redAttack">${player.attack}</span>
    </div>
    <div>
        <p>🛡️</p>
        <span id="redDefense">${player.defense}</span>
    </div>
    <div>
        <p>💥</p>
        <span id="redCrit">${player.critical}</span>
    </div>
     <div>
        <p>🪦</p>
        <span id="redStr">${player.strength}</span>
    </div>
    <div>
        <p>🪄</p>
        <span id="redElmAttack">${player.elm_attack}</span>
    </div>
    <div>
        <p>♠️</p>
        <span id="redElmDef">${player.elm_defense}</span>
    </div>
   <div>
        <p>🧪</p>
        <span id="redPot">${player.potency}</span>
    </div>
        <div>
        <p>⛈</p>
        <span id="redElmEffc">${player.elm_efficiency}</span>
    </div>
        <div>
        <p>🍀</p>
        <span id="redLuck">${player.luck}</span>
    </div>

    <div>
        <p>🎯</p>
        <span id="redAcc">${player.accuracy}</span>
    </div>
    <div>
        <p>🕊</p>
        <span id="redEvas">${player.evasion}</span>
    </div>
    <div>
        <p><img id = 'shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/95c36513-b099-481c-8c69-95184b1b961f/d9vyb32-2451d476-beb8-4925-bd1c-58a83b96cb23.png/v1/fit/w_828,h_1072/796_liquidic_by_tigers_stock_d9vyb32-414w-2x.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTMyNiIsInBhdGgiOiJcL2ZcLzk1YzM2NTEzLWIwOTktNDgxYy04YzY5LTk1MTg0YjFiOTYxZlwvZDl2eWIzMi0yNDUxZDQ3Ni1iZWI4LTQ5MjUtYmQxYy01OGE4M2I5NmNiMjMucG5nIiwid2lkdGgiOiI8PTEwMjQifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.qixgqabB2ZXK93dFP-t3CVRNTz4AQhWvXTTUNR52h7E'></p>
        <span id="redChakra">${player.chakra}</span>
    </div>
    <div>
        <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/3319dd28-31c1-4c70-9762-7302cd5f3a39/d5oj8ng-3aec6bd0-7cbc-4427-9aa3-0959534477f2.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzMzMTlkZDI4LTMxYzEtNGM3MC05NzYyLTczMDJjZDVmM2EzOVwvZDVvajhuZy0zYWVjNmJkMC03Y2JjLTQ0MjctOWFhMy0wOTU5NTM0NDc3ZjIucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0._xkR2jk4ujU4UUBoX4rpsltZual6BjSQHwM5W8cqpyU'></p>
        <span id="redLuck">${player.genjutsu}</span>
    </div>
    <div>
          <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/cbf38665-92e9-4ecb-8712-324e6b7af2f9/dfymy05-ee66f427-b0c8-476f-ab04-f42e3e93aa42.png/v1/fill/w_894,h_894/hymn_of_light_ritual_circle_by_rogermorhan_dfymy05-pre.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MjQwMCIsInBhdGgiOiJcL2ZcL2NiZjM4NjY1LTkyZTktNGVjYi04NzEyLTMyNGU2YjdhZjJmOVwvZGZ5bXkwNS1lZTY2ZjQyNy1iMGM4LTQ3NmYtYWIwNC1mNDJlM2U5M2FhNDIucG5nIiwid2lkdGgiOiI8PTI0MDAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.Bh4EFTpGjHUASHdab8wPDpGy59wA5suWbNIC--cZtgg'></p>
        <span id="redLuck">${player.willpower}</span>
    </div>
    <div>
        <p>${player.chakra_pow}</p>
        <span id="redAcc">${player.ninjutsu_pow}</span>
    </div>





</div>
<hr>
                <p class='words'>${player.chakra_attack} ✮ <span id='cost'>${player.cost}</span></p>
                <p class='words'>${player.ninjutsu} ✮ <span id='cost'>${player.nin_cost}</span></p>
                <hr>
                <p class='words'> ${player.buff} ✮ <span id='buff_red'>${player.buff_acc}%</span></p>
                <p class='words'>${player.buff2} ✮ <span id='buff_red'>${player.buff2_acc}%</span></p>
            </div>
            `;
                    redAttack = player.attack;
                    redDefense = player.defense;
                    redCrit = player.critical;
                    redElmAttack = player.elm_attack;
                    redElmDef = player.elm_defense;
                    redElmEffc = player.elm_efficiency;
                    redHp = player.hp;
                    redStr = player.strength;
                    redPot = player.potency;
                    redBuff = player.buff_acc;
                    redBuff2 = player.buff2_acc;
                    redELM = player.element
                    redRecovery = player.chakra_rec
                    redCost = player.cost
                    redChakraPower = player.chakra_pow
                    redNinjutsu = player.ninjutsu;
                    redNinCost = player.nin_cost;
                    redNinPower = player.ninjutsu_pow
                    redAcc = player.accuracy
                    redEvas = player.evasion
                    redLuck = player.luck
                    redGen = player.genjutsu
                    redWill = player.willpower
                    originalRedRecovery = player.chakra_rec
                    originalRedAttack = player.attack
                    originalRedMagic = player.elm_attack


                } else if (val_2 === player.name) {
                    blueHtml = `
            <div class='fight_time_card'>
                <div class='fight_corner_header'>
                    <h4 class='hi'>${player.name}</h4>
                    <img class='elem_img_corner' src='${player.elm}'>
                </div>
                <img id='fight_corner_img' src='${player.image}'>
                <p id='blueStatus'>${blueStatus}</p>
                <h4 contenteditable="true">🖤 <span id='blueHP'>${player.hp}</span></h4>
                <p>${player.nen_type}</p>
               <div class='fight_corner_stats'>
    <div>
        <p>⚔️</p>
        <span id="blueAttack">${player.attack}</span>
    </div>
    <div>
        <p>🛡</p>
        <span id="blueDefense">${player.defense}</span>
    </div>
    <div>
        <p>💥</p>
        <span id="blueCrit">${player.critical}</span>
    </div>
    <div>
        <p>🪦</p>
        <span id="blueStr">${player.strength}</span>
    </div>
    <div>
        <p>🪄</p>
        <span id="blueElmAttack">${player.elm_attack}</span>
    </div>
    <div>
        <p>♠️</p>
        <span id="blueElmDef">${player.elm_defense}</span>
    </div>
    <div>
        <p>🧪</p>
        <span id="bluePot">${player.potency}</span>
    </div>
    <div>
        <p>⛈</p>
        <span id="blueElmEffc">${player.elm_efficiency}</span>
    </div>
     <div>
        <p>🍀</p>
        <span id="redLuck">${player.luck}</span>
    </div>
    <div>
        <p>🎯</p>
        <span id="blueAcc">${player.accuracy}</span>
    </div>
    <div>
        <p>🕊</p>
        <span id="blueEvas">${player.evasion}</span>
    </div>
    <div>
        <p><img id = 'shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/95c36513-b099-481c-8c69-95184b1b961f/d9vyb32-2451d476-beb8-4925-bd1c-58a83b96cb23.png/v1/fit/w_828,h_1072/796_liquidic_by_tigers_stock_d9vyb32-414w-2x.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTMyNiIsInBhdGgiOiJcL2ZcLzk1YzM2NTEzLWIwOTktNDgxYy04YzY5LTk1MTg0YjFiOTYxZlwvZDl2eWIzMi0yNDUxZDQ3Ni1iZWI4LTQ5MjUtYmQxYy01OGE4M2I5NmNiMjMucG5nIiwid2lkdGgiOiI8PTEwMjQifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.qixgqabB2ZXK93dFP-t3CVRNTz4AQhWvXTTUNR52h7E'></p>
        <span id="blueChakra">${player.chakra}</span>
    </div>
    <div>
           <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/3319dd28-31c1-4c70-9762-7302cd5f3a39/d5oj8ng-3aec6bd0-7cbc-4427-9aa3-0959534477f2.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzMzMTlkZDI4LTMxYzEtNGM3MC05NzYyLTczMDJjZDVmM2EzOVwvZDVvajhuZy0zYWVjNmJkMC03Y2JjLTQ0MjctOWFhMy0wOTU5NTM0NDc3ZjIucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0._xkR2jk4ujU4UUBoX4rpsltZual6BjSQHwM5W8cqpyU'></p>
        <span id="redLuck">${player.genjutsu}</span>
    </div>
    <div>
        <p><img id='shar' src='https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/cbf38665-92e9-4ecb-8712-324e6b7af2f9/dfymy05-ee66f427-b0c8-476f-ab04-f42e3e93aa42.png/v1/fill/w_894,h_894/hymn_of_light_ritual_circle_by_rogermorhan_dfymy05-pre.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MjQwMCIsInBhdGgiOiJcL2ZcL2NiZjM4NjY1LTkyZTktNGVjYi04NzEyLTMyNGU2YjdhZjJmOVwvZGZ5bXkwNS1lZTY2ZjQyNy1iMGM4LTQ3NmYtYWIwNC1mNDJlM2U5M2FhNDIucG5nIiwid2lkdGgiOiI8PTI0MDAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.Bh4EFTpGjHUASHdab8wPDpGy59wA5suWbNIC--cZtgg'></p>
        <span id="redLuck">${player.willpower}</span>
    </div>
    <div>
        <p>${player.chakra_pow}</p>
        <span id="redAcc">${player.ninjutsu_pow}</span>
    </div>
</div>

<hr>
               <p class='words'>${player.chakra_attack} ✮ <span id='cost'>${player.cost}</span></p>
                 <p class='words'>${player.ninjutsu} ✮ <span id='cost'>${player.nin_cost}</span></p>
                  <hr>
               <p class='words'>${player.buff} ✮ <span id='buff_red'>${player.buff_acc}%</span></p>
               <p class='words'>${player.buff2} ✮ <span id='buff_red'>${player.buff2_acc}%</span></p>
            </div>
            `;
                    blueAttack = player.attack;
                    blueDefense = player.defense;
                    blueCrit = player.critical;
                    blueElmAttack = player.elm_attack;
                    blueElmDef = player.elm_defense;
                    blueElmEffc = player.elm_efficiency;
                    blueHp = player.hp;
                    blueStr = player.strength;
                    bluePot = player.potency;
                    blueBuff = player.buff_acc
                    blueBuff2 = player.buff2_acc
                    blueELM = player.element
                    blueRecovery = player.chakra_rec
                    blueCost = player.cost
                    blueChakraPower = player.chakra_pow
                    blueNinjutsu = player.ninjutsu;
                    blueNinCost = player.nin_cost;
                    blueNinPower = player.ninjutsu_pow
                    blueAcc = player.accuracy
                    blueEvas = player.evasion
                    blueLuck = player.luck
                    blueGen = player.genjutsu
                    blueWill = player.willpower
                    originalBlueRecovery = player.chakra_rec
                    originalBlueAttack = player.attack
                    originalBlueMagic = player.elm_attack
                }
            }

            $('#red_corner').html(redHtml);
            $('#blue_corner').html(blueHtml);
            $('#fight_form_fight').hide()

            console.log('Red Stats:', { redAttack, redDefense, redCrit, redElmAttack, redElmDef, redElmEffc, redHp, redStr, redPot });
            console.log('Blue Stats:', { blueAttack, blueDefense, blueCrit, blueElmAttack, blueElmDef, blueElmEffc, blueHp, blueStr, bluePot });
        }



        function filterSuggestions(inputId, suggestionsId, team) {
            $(inputId).on('input', function () {
                let filter = $(this).val().toLowerCase();
                let suggestions = $(suggestionsId);
                suggestions.empty(); // Clear previous suggestions

                if (filter) {
                    for (let player of team) {
                        if (player.name.toLowerCase().includes(filter)) {
                            suggestions.append(`<div>${player.name}</div>`);
                        }
                    }
                }

                // Handle clicking on a suggestion
                $(suggestionsId).on('click', 'div', function () {
                    $(inputId).val($(this).text()); // Set input to selected suggestion
                    suggestions.empty(); // Clear suggestions
                });
            });
        }

        // Apply filtering for red and blue corners
        filterSuggestions('#red_corner_search', '#red_corner_suggestions', databaseArr);
        filterSuggestions('#blue_corner_search', '#blue_corner_suggestions', databaseArr);


        $('#fight_form_fight').submit(action)
    </script>

</html>
